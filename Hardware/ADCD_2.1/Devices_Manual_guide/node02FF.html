<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Devices/apps/ILBMtoC/ILBMtoC.c" NODE="MAIN" TITLE="Devices/apps/ILBMtoC/ILBMtoC.c" -->
<head>
<title>Devices/apps/ILBMtoC/ILBMtoC.c</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Devices_Manual_guide/node02FE.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Devices_Manual_guide/node0300.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
/*--------------------------------------------------------------*/
/*								*/
/* ILBMtoC: reads in ILBM, prints out ascii representation, 	*/
/*  for including in C files. 					*/
/*                                                              */
/* Based on ILBMDump.c by Jerry Morrison and Steve Shaw,	*/
/* Electronic Arts.           					*/
/* Jan 31, 1986							*/
/*                                                              */
/* This software is in the public domain.                       */
/* This version for the Amiga computer.                         */
/*                                                              */
/*  Callable from CLI ONLY					*/
/*  modified 05-91 for use wuth iffparse modules		*/
/*  Requires linkage with several other modules - see Makefile  */
/*--------------------------------------------------------------*/

#include &#034;iffp/ilbmapp.h&#034;

#ifdef LATTICE
int CXBRK(void) { return(0); }  /* Disable Lattice CTRL/C handling */
int chkabort(void) { return(0); }  /* really */
#endif

char *vers = &#034;\0$VER: ILBMtoC 37.5&#034;;
char *Copyright = &#034;ILBMtoC v37.5 (Freely Redistributable)&#034;;

void GetSuffix(UBYTE *to, UBYTE *fr);
void bye(UBYTE *s, int e);
void cleanup(void);

struct Library *IFFParseBase = NULL;
struct Library *GfxBase = NULL;

/* ILBM frame */
struct ILBMInfo ilbm = {0};


/* ILBM Property chunks to be grabbed - only BMHD needed for this app
 */
LONG	ilbmprops[] = {
		ID_ILBM, ID_BMHD,
		TAG_DONE
		};

/* ILBM Collection chunks (more than one in file) to be gathered */
LONG	*ilbmcollects = NULL;	/* none needed for this app */

/* ILBM Chunk to stop on */
LONG	ilbmstops[] = {
		ID_ILBM, ID_BODY,
		TAG_DONE
		};


UBYTE defSwitch[] = &#034;b&#034;;

/** main() ******************************************************************/

void main(int argc, char **argv)
    {
    UBYTE *sw;
    FILE *fp;
    LONG error=NULL;
    UBYTE *ilbmname, name[80], fname[80];

    if ((argc &#060; 2)||(argv[argc-1][0]=='?'))
	{
	printf(&#034;Usage from CLI: 'ILBMtoC filename switch-string'\n&#034;);
	printf(&#034; where switch-string = \n&#034;);
	printf(&#034;  &#060;nothing&#062; : Bob format (default)\n&#034;);
	printf(&#034;  s         : Sprite format (with header and trailer words)\n&#034;);
	printf(&#034;  sn        : Sprite format (No header and trailer words)\n&#034;);
	printf(&#034;  a         : Attached sprite (with header and trailer)\n&#034;);
	printf(&#034;  an        : Attached sprite (No header and trailer)\n&#034;);
	printf(&#034; Add 'c' to switch list to output CR's with LF's   \n&#034;);
	exit(RETURN_OK);
	}


    if(!(GfxBase = OpenLibrary(&#034;graphics.library&#034;,0)))
	bye(&#034;Can't open graphics.library&#034;,RETURN_FAIL);

    if(!(IFFParseBase = OpenLibrary(&#034;iffparse.library&#034;,0)))
	bye(&#034;Can't open iffparse.library&#034;,RETURN_FAIL);

/*
 * Here we set up default ILBMInfo fields for our
 * application's frames.
 * Above we have defined the propery and collection chunks
 * we are interested in (some required like BMHD)
 */
    ilbm.ParseInfo.propchks      = ilbmprops;
    ilbm.ParseInfo.collectchks   = ilbmcollects;
    ilbm.ParseInfo.stopchks      = ilbmstops;
    if(!(ilbm.ParseInfo.iff = AllocIFF()))
    	bye(IFFerr(IFFERR_NOMEM),RETURN_FAIL);	/* Alloc an IFFHandle */

    sw = (argc&#062;2) ? (UBYTE *)argv[2] : defSwitch;
    ilbmname = argv[1];

    if (error = loadbrush(&#038;ilbm,ilbmname))
        {
        printf(&#034;Can't load ilbm \&#034;%s\&#034;, ifferr=%s\n&#034;,ilbmname,IFFerr(error));
        bye(&#034;&#034;,RETURN_WARN);
        }
    else /* Successfully loaded ILBM */
	{
	printf(&#034; Creating file %s.c \n&#034;,argv[1]);
	GetSuffix(name,argv[1]);
	strcpy(fname,argv[1]);
	strcat(fname,&#034;.c&#034;);
	fp = fopen(fname,&#034;w&#034;);
	if(fp)
	    {
	    BMPrintCRep(ilbm.brbitmap,fp,name,sw);
	    fclose(fp);
	    }
	else  printf(&#034;Couldn't open output file: %s. \n&#034;, fname);
	unloadbrush(&#038;ilbm);
	}
    printf(&#034;\n&#034;);
    bye(&#034;&#034;,RETURN_OK);
    }



/* this copies part of string after the last '/' or ':' */
void GetSuffix(to, fr) UBYTE *to, *fr; {
    int i;
    UBYTE c,*s = fr;
    for (i=0; ;i++) {
	c = *s++;
	if (c == 0) break;
	if (c == '/') fr = s;
	else if (c == ':') fr = s;
	}
    strcpy(to,fr);
    }


void bye(UBYTE *s, int e)
    {
    if(s&#038;&#038;(*s))	printf(&#034;%s\n&#034;,s);
    cleanup();
    exit(e);
    }


void cleanup()
    {
    if(ilbm.ParseInfo.iff)		FreeIFF(ilbm.ParseInfo.iff);

    if(IFFParseBase)	CloseLibrary(IFFParseBase);
    if(GfxBase)		CloseLibrary(GfxBase);
    }
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
