<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Devices/Dev_15" NODE="15-5" TITLE="15 Resources / CIA Resource" INDEX="Devices/Dev_Index/MAIN" -->
<head>
<title>15 Resources / CIA Resource</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Devices_Manual_guide/node012A.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Devices_Manual_guide/node010C.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Devices_Manual_guide/node010E.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
The CIA resource provides access to the timers and timer interrupt bits of
the <a href="../Hardware_Manual_guide/node012E.html">8520 Complex Interface Adapter</a> (CIA) A and B chips.   This resource is
intended for use by high performance timing applications such as MIDI time
stamping and SMPTE time coding.

<a name="line7">Four functions allow you to interact with the CIA hardware.</a>

                           CIA Resource Functions
                           ----------------------
     <a href="../Includes_and_Autodocs_2._guide/node0536.html">AbleICR()</a>             Enable or disable Interrupt Control
                           Register interrupts.  Can also return the
                           current or previous enabled interrupt mask.

     <a href="../Includes_and_Autodocs_2._guide/node0537.html">AddICRVector()</a>        Allocate one of the CIA timers by assigning
                           an interrupt handler to an interrupt bit
                           and enabling the interrupt of one of the
                           timers. If the timer you request is not
                           available, a pointer to the interrupt
                           structure that owns it will be returned.

     <a href="../Includes_and_Autodocs_2._guide/node0538.html">RemICRVector()</a>        Remove an interrupt handler from an
                           interrupt bit and disable the interrupt.

     <a href="../Includes_and_Autodocs_2._guide/node0539.html">SetICR()</a>              Cause or clear one or more interrupts, or
                           return the current or previous interrupt
                           status.

Each CIA chip has two interval timers within it - Timer A and Timer
B - that may be available. The CIA chips operate at different interrupt
levels with the CIA-A timers at interrupt level 2 and the CIA-B timers at
interrupt level 6.

   Choose A Timer Wisely.
   ----------------------
   The timer you use should be based solely on interrupt level and
   availability. If the timer you request is not available, try for
   another.  Whatever you do, do not base your decision on what you
<a name="line39">   think the timer is used for by the system.</a>

You allocate a timer by calling <a href="../Includes_and_Autodocs_2._guide/node0537.html">AddICRVector()</a>. This is the only way you
should access a timer.   If the function returns zero, you have
successfully allocated that timer.  If it is unavailable, the owner
interrupt will be returned.

   /* allocate CIA-A Timer A */
   inta = AddICRVector (CIAResource, CIAICRB_TA, &#038;tint);

   if (inta)  /* if allocate was not successful */
       printf(&#034;Error: Could not allocate timer\n&#034;);
   else
       {
       ...ready for timing
       }

The timer is deallocated by calling <a href="../Includes_and_Autodocs_2._guide/node0538.html">RemICRVector()</a>.  This is the only way
you should deallocate a timer.

   RemICRVector(CIAResource, CIAICRB_TA, &#038;tint);

Your application should not make any assumptions regarding which interval
timers (if any) are available for use; other tasks or critical operating
system routines may be using the interval timers. In fact, in the latest
version of the operating system, the <a href="../Devices_Manual_guide/node00BD.html">timer device</a> may dynamically allocate
one of the interval timers.

   Time Is Of The Essence!
   -----------------------
   There are a limited number of free CIA interval timers.  Applications
   which use the interval timers may not be able to run at the same time
   if all interval timers are in use.  As a general rule, you should use
<a name="line72">   the timer device for most interval timing.</a>

You read from and write to the CIA interrupt control registers using
<a href="../Includes_and_Autodocs_2._guide/node0539.html">SetICR()</a> and <a href="../Includes_and_Autodocs_2._guide/node0536.html">AbleICR()</a>.  <a href="../Includes_and_Autodocs_2._guide/node0539.html">SetICR()</a> is useful for sampling which cia
interrupts (if any) are active.  It can also be used to clear and generate
interrupts.  <a href="../Includes_and_Autodocs_2._guide/node0536.html">AbleICR()</a> is used to disable and enable a particular CIA
interrupt.  Additional information about these functions can be found in
<a name="line79">the Amiga ROM Kernel Reference Manual: Includes and Autodocs.</a>

Things to keep in mind:

   1. Never directly read from or write to the CIA interrupt control
      registers.  Always use <a href="../Includes_and_Autodocs_2._guide/node0539.html">SetICR()</a> and <a href="../Includes_and_Autodocs_2._guide/node0536.html">AbleICR()</a>.

   2. Your interrupt routine will be called with a pointer to your data
      area in register A1, and a pointer to the code being called in
      register A5. No other registers are set up for you.  You must observe
      the standard convention of preserving all registers except D0-D1 and
      A0-A1.

   3. Never turn off all level 2 or level 6 interrupts.  The proper way to
      disable interrupts for an interval timer that you've successfully
      allocated is via the <a href="../Includes_and_Autodocs_2._guide/node0536.html">AbleICR()</a> function.

   4. Interrupt handling code should be written in assembly code and, if
      possible, should signal a task to do most of the work.

   5. Do not make assumptions about which CIA interval timers (if any) are
      available for use.  The only proper way to own an interval timer is
      via the <a href="../Includes_and_Autodocs_2._guide/node0537.html">AddICRVector()</a> function.

   6. Do not use <a href="../Includes_and_Autodocs_2._guide/node0539.html">SetICR()</a>, <a href="../Includes_and_Autodocs_2._guide/node0536.html">AbleICR()</a> and <a href="../Includes_and_Autodocs_2._guide/node0538.html">RemICRVector()</a> to affect timers or
      other CIA hardware which your task does not own.

Changes in the CIA resource:

   *  In pre-V36 versions of the operating system, <a href="../Includes_and_Autodocs_2._guide/node0539.html">SetICR()</a> could return
      FALSE for a particular interrupt just prior to processing the
      interrupt. <a href="../Includes_and_Autodocs_2._guide/node0539.html">SetICR()</a> now returns TRUE for a particular interrupt until
      sometime after the interrupt has been processed.

   *  Applications which only need to read a CIA interval timer should use
      the <a href="../Includes_and_Autodocs_2._guide/node04FB.html">ReadEClock()</a> function of the timer device.  See &#034;<a href="../Devices_Manual_guide/node00C8.html">Timer Device</a>&#034;
      chapter of this manual for more information on ReadEClock().

   *  The timer device may dynamically allocate a free CIA interval timer.
      Do not make any assumptions regarding which interval timers are in
      use unless you are taking over the machine completely.

<a name="line121">     <a href="../Devices_Manual_guide/node01A2.html">Cia_Interval.c</a> </a>

Additional programming information on the CIA resource can be found in the
include files and the Autodocs for the CIA resource and the 8520 spec.
The includes files and Autodocs are in the Amiga ROM Kernel Reference
Manual: Includes and Autodocs and the 8520 spec is in the Amiga
<a href="../Hardware_Manual_guide/node012E.html">Hardware Reference Manual</a>.

                         CIA Resource Information
                     -------------------------------
                     INCLUDES        resources/<a href="../Includes_and_Autodocs_2._guide/node010D.html">cia.h</a>
                                     resources/<a href="../Includes_and_Autodocs_2._guide/node0110.html">cia.i</a>
                                     hardware/<a href="../Includes_and_Autodocs_2._guide/node00C7.html">cia.h</a>
                                     hardware/<a href="../Includes_and_Autodocs_2._guide/node00CA.html">cia.i</a>

                     AUTODOCS        <a href="../Includes_and_Autodocs_2._guide/node0535.html">cia.doc</a>

                     HARDWARE        8520 specification
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
