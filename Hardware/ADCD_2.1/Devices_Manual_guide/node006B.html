<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Devices/Dev_3" NODE="3-2-4" TITLE="3 / Device Interface / Writing To The Clipboard Device" INDEX="Devices/Dev_Index/MAIN" -->
<head>
<title>3 / Device Interface / Writing To The Clipboard Device</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Devices_Manual_guide/node012A.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Devices_Manual_guide/node006A.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Devices_Manual_guide/node006C.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
You write to the clipboard device by passing an <a href="../Devices_Manual_guide/node0067.html#line5">IOClipReq</a> to the device
with CMD_WRITE set in io_Command, the number of bytes to be written set in
io_Length and the address of the write buffer set in io_Data.

    ClipIO-&#062;io_Data = (char *) data;
    ClipIO-&#062;io_Length = 4L;
<a name="line8">    ClipIO-&#062;io_Command = CMD_WRITE;</a>

An initial write should set io_Offset to zero.  Each time a write is done,
the device will increment io_Offset by the length of the write.

As previously stated, the data you write to the clipboard must be in IFF
format.  This requires a certain amount of preparation prior to actually
writing the data if it is not already in IFF format.  A brief explanation
<a name="line16">of the IFF format will be helpful in this regard.</a>

For our purposes, we will limit our discussion to a simple formatted text
(FTXT) IFF file.  An FTXT file looks like:

           FORM &#060;length of succeeding bytes&#062;
           FTXT
           CHRS &#060;length of succeeding bytes&#062;
                &#060;data bytes&#062;
                &#060;pad byte of zero if the preceding chunk has odd length&#062;

           Note: Uppercase characters above are literals.

Based on the above file format, a hex dump of an IFF FTXT file containing
 the string &#034;Enterprise&#034; would look like:

           0000   464F524D  FORM
           0004   00000016  (length of FTXT, CHRS, 0xA and data)
           0008   46545854  FTXT
           000C   43485253  CHRS
           0010   0000000A  (length of Enterprise)
           0014   456E7465  Ente
           0018   72707269  rpri
           001C   7365      se

A code fragment for doing this:

    LONG slen = strlen (&#034;Enterprise&#034;);
    BOOL odd = (slen &#038; 1);      /* pad byte flag */

    /* set length depending on whether string is odd or even length */
    LONG length = (odd) ? slen + 1 : slen;

    /* Reset the clip id */
    ClipIO-&#062;io_ClipID = 0;
    ClipIO-&#062;io_Offset = 0;

    error = writeLong ((LONG *) &#034;FORM&#034;);/* &#034;FORM&#034; */

    /* add 12 bytes for FTXT,CHRS &#038; length byte to string length */
    length += 12;
    error = writeLong (&#038;length);
    error = writeLong ((LONG *) &#034;FTXT&#034;);/* &#034;FTXT&#034; for example */
    error = writeLong ((LONG *) &#034;CHRS&#034;);/* &#034;CHRS&#034; for example */
    error = writeLong (&#038;slen);      /* #  (length of string) */

    ClipIO-&#062;io_Command = CMD_WRITE;
    ClipIO-&#062;io_Data = (char *) string;
    ClipIO-&#062;io_Length = slen;               /* length of string */
    error = (LONG) DoIO (clipIO);   /* text string */

    LONG writeLong (LONG * ldata)
    {
        ClipIO-&#062;io_Command = CMD_WRITE;
        ClipIO-&#062;io_Data = (char *) ldata;
        ClipIO-&#062;io_Length = 4L;
        return ( (LONG) DoIO (clipIO) );
    }

The fragment above does no error checking because it's a fragment.  You
should always error check.  See the example programs at the end of this
chapter for the proper method of error checking.

   Iffparse That Data!
   -------------------
   Keep in mind that the functions in the <a href="../Libraries_Manual_guide/node0427.html">iffparse.library</a> can be used
   to write data to the clipboard. See the &#034;<a href="../Libraries_Manual_guide/node0427.html">IFFParse Library</a>&#034; chapter
   of the Amiga ROM Kernel Reference Manual: Libraries for more
   information.
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
