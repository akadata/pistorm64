<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Devices/Dev_10" NODE="10-10-1-2" TITLE="10 / / Writing An Alphanumeric Printer Driver / DoSpecial()" INDEX="Devices/Dev_Index/MAIN" -->
<head>
<title>10 / / Writing An Alphanumeric Printer Driver / DoSpecial()</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Devices_Manual_guide/node012A.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Devices_Manual_guide/node0056.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Devices_Manual_guide/node0058.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
The DoSpecial() function is meant to implement all the ANSI functions that
cannot be done by simple substitution, but can be handled by a more
complex sequence of control characters sent to the printer. These are
functions that need parameter conversion, read values from Preferences,
and so on. Complete routines can also be placed in dospecial.c. For
instance, in a driver for a page oriented-printer such as the HP LaserJet,
the dummy <a href="../Includes_and_Autodocs_2._guide/node028A.html">Close()</a> routine from the init.asm file would be replaced by a
real Close() routine in dospecial.c. This close routine would handle
ejecting the paper after text has been sent to the printer and the printer
has been closed.

The DoSpecial() function is set up as follows:

   #include &#034;exec/types.h&#034;
   #include &#034;devices/printer.h&#034;
   #include &#034;devices/prtbase.h&#034;

   extern struct PrinterData *PD;

   DoSpecial(command,outputBuffer,vline,currentVMI,crlfFlag,Parms)
   UBYTE outputBuffer[];
   UWORD *command;
   BYTE *vline;
   BYTE *currentVMI;
   BYTE *crlfFlag;
   UBYTE Parms[];
   {                /* code begins here... */

   where

   command
      points to the command number. The devices/<a href="../Includes_and_Autodocs_2._guide/node0052.html">printer.h</a> file contains the
      definitions for the routines to use (aRIN is initialize, and so on).

   vline
      points to the value for the current line position.

   currentVMI
      points to the value for the current line spacing.

   crlfFlag
      points to the setting of the &#034;add line feed after carriage return&#034;
<a name="line44">      flag.</a>

   Parms
      contain whatever parameters were given with the ANSI command.

   outputBuffer
      points to the memory buffer into which the converted command is
      returned.

Almost every printer will require an aRIN (initialize) command in
DoSpecial(). This command reads the printer settings from Preferences and
creates the proper control sequence for the specific printer.  It also
returns the character set to normal (not italicized, not bold, and so on).
Other functions depend on the printer.

Certain functions are implemented both in the <a href="../Devices_Manual_guide/node0056.html">CommandTable</a> and in the
DoSpecial() routine. These are functions such as superscript, subscript,
PLU (partial line up), and PLD (partial line down), which can often be
handled by a simple conversion. However, some of these functions must also
adjust the printer device's line-position variable.

   Save the Data!
   --------------
   Some printers lose data when sent their own reset command. For this
   reason, it is recommended that if the printer's own reset command is
   going to be used, PD-&#062;pd_PWaitEnabled should be defined to be a
   character that the printer will not print. This character should be
   put in the reset string before and after the reset character(s) in
   the command table.

In the EpsonX[CBM_MPS-1250] DoSpecial() function you'll see

   if (*command == aRIS)
       {        /* reset command */
       PD-&#062;pd_PWaitEnabled = \375; /* preserve that data! */
   }

while in the command table the string for reset is defined as
&#034;\\375\\033@\\375&#034;. This means that when the printer device outputs the
reset string &#034;\\033@&#034;, it will first see the &#034;\\375&#034;, wait a second and
output the reset string. While the printer is resetting, the printer
device gets the second &#034;\\375&#034; and waits another second. This ensures that
no data will be lost if a reset command is embedded in a string.
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
