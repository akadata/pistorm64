<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Devices/Dev_4" NODE="4-2-2" TITLE="4 / Device Interface / Opening The Console Device" INDEX="Devices/Dev_Index/MAIN" -->
<head>
<title>4 / Device Interface / Opening The Console Device</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Devices_Manual_guide/node012A.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Devices_Manual_guide/node0083.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Devices_Manual_guide/node0085.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
Four primary steps are required to open the console device:

   *  Create a message port using <a href="../Includes_and_Autodocs_2._guide/node0148.html">CreatePort()</a>. Reply messages from the
      device must be directed to a message port.

   *  Create an I/O request structure of type <a href="../Devices_Manual_guide/node0082.html#line7">IOStdReq</a>. The IOStdReq
      structure is created by the <a href="../Includes_and_Autodocs_2._guide/node0147.html">CreateExtIO()</a> function. CreateExtIO will
      initialize your I/O request to point to your reply port.

   *  Open an Intuition window and set a pointer to it in the io_Data field
      of the <a href="../Devices_Manual_guide/node0082.html#line7">IOStdReq</a> and the size of the window in the io_Length field.
      This is the window to which the console will be attached.  The window
      must be SIMPLE_REFRESH for use with the CONU_CHARMAP and CONU_SNIPMAP
<a name="line15">      units.</a>

   *  Open the console device.  Call <a href="../Includes_and_Autodocs_2._guide/node0509.html">OpenDevice()</a> passing it the I/O
      request and the type of console unit set in the unit and flags
<a name="line19">      fields. Console unit types and flag values are listed below.</a>

<a name="line21">Console device units:</a>

   *  CONU_LIBRARY  - Return the device library vector pointer used for
<a name="line24">      calling console device functions.  No console is opened.</a>

<a name="line26">   *  CONU_STANDARD - Open a standard console.</a>

<a name="line28">   *  CONU_CHARMAP  - Open a console with a character map.</a>

   *  CONU_SNIPMAP  - Open a console with a character map and
      copy-and-paste support.

See the include file devices/<a href="../Includes_and_Autodocs_2._guide/node0058.html">conunit.h</a> for the unit definitions
and the Amiga ROM Kernel Reference Manual: Includes and Autodocs for an
explanation of each unit.

   No Changes Required
   -------------------
   CONU_STANDARD has a numeric value of zero to insure compatibility
   with pre-V36 applications.  CONU_LIBRARY has a numeric value of
   negative one and is also compatible with pre-V36 applications.
<a name="line42"></a>
Console device flags:

<a name="line45">   *  CONFLAG_DEFAULT - The console device will redraw the window when it</a>
      is resized.

   *  CONFLAG_NODRAW_ON_NEWSIZE - The console device will not redraw the
      window when it is resized

The character map units, CONU_CHARMAP and CONU_SNIPMAP, are the only units
which use the flags parameter to set how the character map is used.
CONU_STANDARD units ignore the flags parameter.

See the include file devices/<a href="../Includes_and_Autodocs_2._guide/node0058.html">conunit.h</a> for the flag definitions and the
Amiga ROM Kernel Reference Manual: Includes and Autodocs for an
explanation of the flags.

<a name="line59">    struct MsgPort *ConsoleMP;   /* Message port pointer */</a>
    struct IOStdReq *ConsIO;     /* I/O structure pointer */
    struct Window   *win = NULL; /* Window pointer */

    struct NewWindow nw =
    {
        10, 10,                    /* starting position (left,top) */
        620,180,                   /* width, height */
        -1,-1,                     /* detailpen, blockpen */
        CLOSEWINDOW,               /* flags for idcmp */
        WINDOWDEPTH|WINDOWSIZING|
        WINDOWDRAG|WINDOWCLOSE|
        SIMPLE_REFRESH|ACTIVATE,    /* window flags */
        NULL,                      /* no user gadgets */
        NULL,                      /* no user checkmark */
        &#034;Console Test&#034;,            /* title */
        NULL,                      /* pointer to window screen */
        NULL,                      /* pointer to super bitmap */
        100,45,                    /* min width, height */
        640,200,                   /* max width, height */
        WBENCHSCREEN               /* open on workbench screen */
    };

        /* Create reply port console */
    if (!(ConsoleMP = CreatePort(&#034;RKM.Console&#034;,0)))
        cleanexit(&#034;Can't create write port\n&#034;,RETURN_FAIL);

        /* Create message block for device I/O */
    if (!(ConsIO = CreateExtIO(ConsoleMP,sizeof(struct IOStdReq))))
        cleanexit(&#034;Can't create IORequest\n&#034;,RETURN_FAIL);

        /* Open a window - we assume intuition.library is already open */
    if (!(win = OpenWindow(&#038;nw)))
        cleanexit(&#034;Can't open window\n&#034;,RETURN_FAIL);

        /* Set window pointer and size in I/O request */
    ConsIO-&#062;io_Data = (APTR) win;
    ConsIO-&#062;io_Length = sizeof(struct Window);

        /* Open the console device */
    if (error = OpenDevice(&#034;console.device&#034;,CONU_CHARMAP,ConsIO,
                                            CONFLAG_DEFAULT))
        cleanexit(&#034;Can't open console.device\n&#034;,RETURN_FAIL);
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
