<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Devices/Dev_4" NODE="4-9" TITLE="4 Console Device / Using the Console Device Without a Window" INDEX="Devices/Dev_Index/MAIN" -->
<head>
<title>4 Console Device / Using the Console Device Without a Window</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Devices_Manual_guide/node012A.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Devices_Manual_guide/node0095.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Devices_Manual_guide/node0097.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
Most console device processing involves a window, but there are functions
and special commands that may be used without a window.  To use the
console device without a window, you call <a href="../Includes_and_Autodocs_2._guide/node0509.html">OpenDevice()</a> with the console
<a name="line5">unit CONU_LIBRARY.</a>

The console device functions are <a href="../Includes_and_Autodocs_2._guide/node0505.html">CDInputHandler()</a> and <a href="../Includes_and_Autodocs_2._guide/node050A.html">RawKeyConvert()</a>;
they may only be used with the CONU_LIBRARY console unit.  The console
device commands which do not require a window are <a href="../Includes_and_Autodocs_2._guide/node0501.html">CD_ASKDEFAULTKEYMAP</a>
and <a href="../Includes_and_Autodocs_2._guide/node0503.html">CD_SETDEFAULTKEYMAP</a>; they be used with any console unit.  The
advantage of using the commands with the CONU_LIBRARY unit is the lack of
overhead required for CONU_LIBRARY because it doesn't require a window.

To use the functions requires the following steps:

   *  Declare the console device base address variable ConsoleDevice in the
      global data area.

   *  Declare storage for an I/O request of type <a href="../Devices_Manual_guide/node0082.html#line7">IOStdReq</a>.

   *  Open the console device with CONU_LIBRARY set as the console unit.

   *  Set the console device base address variable to point to the device
      library vector which is returned in io_Device.

   *  Call the console device function(s).

   *  Close the console device when you are finished.


   #include &#060;devices/conunit.h&#062;
   struct ConsoleDevice *ConsoleDevice;  /* declare device base address */

   struct IOStdReq ConsIO= {0};          /* I/O request */

   main()


       /* Open the device with CONU_LIBRARY for function use */
   if (0 == OpenDevice(&#034;console.device&#034;,CONU_LIBRARY,
                      (struct IORequest *)&#038;ConsIO,0) )
       {
       /* Set the base address variable to the device library vector */
       ConsoleDevice = (struct ConsoleDevice *)ConsIO.io_Device;

                     .
                     .    (console device functions would be called here)
                     .

       CloseDevice(ConsIO);
       }

The code fragment shows only the steps outlined above, it is not complete
in any sense of the word.  For a complete example of using a console
device function, see the <a href="../Devices_Manual_guide/node0191.html">rawkey.c</a> code example in the
&#034;<a href="../Libraries_Manual_guide/node01E4.html">Intuition: Mouse and Keyboard</a>&#034; chapter of the Amiga ROM Kernel Reference
Manual: Libraries.  The example uses the <a href="../Includes_and_Autodocs_2._guide/node050A.html">RawKeyConvert()</a> function.

To use the commands with the CONU_LIBRARY console unit, you follow the
same steps that were outlined in the <a href="../Devices_Manual_guide/node0084.html">Opening the Console Device</a> section of
this chapter.

   struct MsgPort *ConsoleMP;       /* pointer to our message port */
   struct IOStdReq *ConsoleIO;      /* pointer to our I/O request */
   struct KeyMap  *keymap;          /* pointer to keymap */

       /* Create the message port */
   if (ConsoleMP=CreateMsgPort())
       {
           /* Create the I/O request */
       if (ConsoleIO = CreateIORequest(ConsoleMP,sizeof(struct IOStdReq)))
           {
               /* Open the Console device */
           if (OpenDevice(&#034;console.device&#034;,CONU_LIBRARY,
                         (struct IORequest *)ConsoleIO,0L))

               /* Inform user that it could not be opened */
               printf(&#034;Error: console.device did not open\n&#034;);
           else
               {
                  /* Allocate memory for the keymap */
               if (keymap = (struct KeyMap *)
                  AllocMem(sizeof(struct KeyMap),MEMF_PUBLIC | MEMF_CLEAR))
                  {
                  /* device opened, send CD_ASKKEYMAP command to it */
                  ConsoleIO-&#062;io_Length = sizeof(struct KeyMap);
                  ConsoleIO-&#062;io_Data = (APTR)keymap; /* where to put it */
                  ConsoleIO-&#062;io_Command = CD_ASKKEYMAP;
                  DoIO((struct IORequest *)ConsoleIO))
                  }

               CloseDevice(ConsIO);
               }

Again, as in the previous code fragment, this is not complete (that's why
it's a fragment!) and you should only use it as a guide.
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
