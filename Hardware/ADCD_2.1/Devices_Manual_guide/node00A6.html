<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Devices/Dev_12" NODE="12-5" TITLE="12 Serial Device / Setting Serial Parameters (SDCMD_SETPARAMS)" INDEX="Devices/Dev_Index/MAIN" -->
<head>
<title>12 Serial Device / Setting Serial Parameters (SDCMD_SETPARAMS)</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Devices_Manual_guide/node012A.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Devices_Manual_guide/node00A5.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Devices_Manual_guide/node00A7.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
When the serial device is opened, default values for baud rate and other
parameters are automatically filled in from the serial settings in
Preferences.  The parameters may be changed by using the
<a href="../Includes_and_Autodocs_2._guide/node04D7.html">SDCMD_SETPARAMS</a> command.  The flags are defined in the include file
devices/<a href="../Includes_and_Autodocs_2._guide/node004B.html">serial.h</a>.

                   SERIAL DEVICE PARAMETERS (<a href="../Devices_Manual_guide/node009C.html#line7">IOExtSer</a>)

   IOExtSer
   Field Name   Serial Device Parameter It Controls
   ---------    -----------------------------------
   io_CtlChar   Control characters to use for xON, xOFF,
                INQ, ACK respectively.  Positioned within an unsigned
                longword in the sequence from low address to high as
                listed.  INQ and ACK handshaking is not currently
                supported.

   io_RBufLen   Recommended size of the buffer that the serial device
                should allocate for incoming data.  For some hardware the
                buffer size will not be adjustable.  Changing the value
                may cause the device to allocate a new buffer, which might
                fail due to lack of memory. In this case the old buffer
                will continue to be used.

                For the built-in unit, the minimum size is 64 bytes.
                Out-of-range numbers will be truncated by the device.
                When you do an <a href="../Includes_and_Autodocs_2._guide/node04D7.html">SDCMD_SETPARAMS</a> command, the driver senses
                the difference between its current value and the value of
                buffer size you request.  All characters that may already
                be in the old buffer will be discarded.  Thus it is wise
                to make sure that you do not attempt buffer size changes
<a name="line33">                (or any change to the serial device, for that matter)</a>
                while any I/O is actually taking place.

   io_ExtFlags  An unsigned long that contains the flags SEXTF_MSPON and
                SEXTF_MARK.  SEXTF_MSPON enables either mark or space
                parity.  SEXTF_MARK selects mark parity (instead of space
                parity).  Unused bits are reserved.

   io_Baud      The real baud rate you request.  This is an unsigned long
                value in the range of 1 to 4,294,967,295.  The device will
                reject your baud request if the hardware is unable to
                support it.

                For the built-in driver, any baud rate in the range of 110
                to about 1 megabaud is acceptable.  The built-in driver
                may round 110 baud requests to 112 baud. Although baud
                rates above 19,200 are supported by the hardware, software
                overhead will limit your ability to &#034;catch&#034; every single
                character that should be received.  Output data rate,
                however, is not software-dependent.

   io_BrkTime   If you issue a break command, this variable specifies how
                long, in microseconds, the break condition lasts.  This
                value controls the break time for all future break
                commands until modified by another <a href="../Includes_and_Autodocs_2._guide/node04D7.html">SDCMD_SETPARAMS</a>.

   io_TermArray A byte-array of eight termination characters, must be in
                descending order.  If the EOFMODE bit is set in the serial
                flags, this array specifies eight possible choices of
                character to use as an end of file mark.  See the section
                above &#034;<a href="../Devices_Manual_guide/node00A4.html">Ending a Read Or Write Using Termination Characters</a>&#034;
                and the <a href="../Includes_and_Autodocs_2._guide/node04D7.html">SDCMD_SETPARAMS</a> summary page in the Autodocs.

   io_ReadLen   How many bits per read character; typically a value of 7
                or 8.  Generally must be the same as io_WriteLen.

   io_WriteLen  How many bits per write character; typically a value of 7
                or 8.  Generally must be the same as io_ReadLen.

   io_StopBits  How many stop bits are to be expected when reading a
                character and to be produced when writing a character;
                typically 1 or 2. The built-in driver does not allow
                values above 1 if io_WriteLen is larger than 7.

 io_SerFlags    See the &#034;<a href="../Devices_Manual_guide/node00A7.html">Serial Flags</a>&#034; section below.

 io_Status      Contains status information filled in by the <a href="../Includes_and_Autodocs_2._guide/node04D6.html">SDCMD_QUERY</a>
                command.  Break status is cleared by the execution of
                SDCMD_QUERY.

You set the serial parameters by passing an <a href="../Devices_Manual_guide/node009C.html#line7">IOExtSer</a> to the device with
<a href="../Includes_and_Autodocs_2._guide/node04D7.html">SDCMD_SETPARAMS</a> set in io_Command and with the flags and parameters set to
the values you want.

  SerialIO-&#062;io_SerFlags      &#038;= ~SERF_PARTY_ON; /* set parity off */
  SerialIO-&#062;io_SerFlags      |= SERF_XDISABLED; /* set xON/xOFF disabled */
  SerialIO-&#062;io_Baud           = 9600;           /* set 9600 baud */
  SerialIO-&#062;IOSer.io_Command  = SDCMD_SETPARAMS;/* Set params command */
  if (DoIO((struct IORequest *)SerialIO))
      printf(&#034;Error setting parameters!\n&#034;);

The above fragment modifies two bits in io_SerFlags and changes the baud
rate. If the parameters you request are unacceptable or out of range, the
<a href="../Includes_and_Autodocs_2._guide/node04D7.html">SDCMD_SETPARAMS</a> command will fail.  You are responsible for checking the
error code and informing the user.

   Proper Time for Parameter Changes.
   ----------------------------------
   A parameter change should not be performed while an I/O request is
   actually being processed because it might invalidate the request
   handling already in progress.  To avoid this, you should use
   <a href="../Includes_and_Autodocs_2._guide/node04D7.html">SDCMD_SETPARAMS</a> only when you have no serial I/O requests pending.

 <a href="../Devices_Manual_guide/node00A7.html">Serial Flags (Bit Definitions For io_SerFlags)</a>  
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
