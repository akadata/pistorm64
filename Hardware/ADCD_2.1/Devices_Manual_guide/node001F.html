<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Devices/Dev_2" NODE="2-3-1" TITLE="2 / Device Interface / Opening The Audio Device" INDEX="Devices/Dev_Index/MAIN" -->
<head>
<title>2 / Device Interface / Opening The Audio Device</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Devices_Manual_guide/node012A.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Devices_Manual_guide/node001E.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Devices_Manual_guide/node0020.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
Before you can use the audio device, you must first open it with a call to
<a href="../Includes_and_Autodocs_2._guide/node04B8.html">OpenDevice()</a>. Four primary steps are required to open the audio device:

   *  Create a message port using <a href="../Includes_and_Autodocs_2._guide/node0148.html">CreatePort</a> Reply messages from the
      device must be directed to a message port.

   *  Allocate memory for an extended I/O request structure of type
      <a href="../Devices_Manual_guide/node001E.html#line8">IOAudio</a> using <a href="../Includes_and_Autodocs_2._guide/node0332.html">AllocMem()</a>.

   *  Fill in io_Message.mn_ReplyPort with the message port created by
      CreatePort.

   *  Open the audio device.  Call OpenDevice(), passing IOAudio.


  struct MsgPort  *AudioMP;      /* Define storage for port pointer */
  struct IOAudio  *AudioIO;      /* Define storage for IORequest pointer */

  if (AudioMP = CreatePort(0,0) )
      {
      AudioIO = (struct IOAudio *)
                AllocMem(sizeof(struct IOAudio), MEMF_PUBLIC | MEMF_CLEAR);
      if (AudioIO)
          {
          AudioIO-&#062;ioa_Request.io_Message.mn_ReplyPort  = AudioMP;
          AudioIO-&#062;ioa_AllocKey                         = 0;
          }

      if (OpenDevice(AUDIONAME,0L,(struct IORequest *)AudioIO,0L) )
          printf(&#034;%s did not open\n&#034;,AUDIONAME);

A special feature of the OpenDevice() function with the audio device
allows you to automatically allocate channels for your program to use when
the device is opened.  This is convenient since you must allocate one or
more channels before you can produce sound.

This is done by setting ioa_AllocKey to zero, setting
ioa_Request.io_Message.mn_Node.ln_Pri to the appropriate precedence,
setting io_Data to the address of a channel combination array, and setting
ioa_Request.ioa_Length to a non-zero value (the length of the channel
combination array).  The audio device will attempt to allocate channels
just as if you had sent the <a href="../Devices_Manual_guide/node002A.html">ADCMD_ALLOCATE</a> command (see below).  If the
allocation fails, the OpenDevice() call will return immediately.

If you want to allocate channels at some later time, set the
ioa_Request.ioa_Length field of the IOAudio block to zero when you call
OpenDevice().  For more on channel allocation and the  <a href="../Devices_Manual_guide/node002A.html">ADCMD_ALLOCATE</a>
command, see the section on <a href="../Devices_Manual_guide/node0029.html">Allocation and Arbitration</a> below.

    UBYTE chans[] = {1,2,4,8};  /* get any of the four channels */

    if (AudioIO)
        {
        AudioIO-&#062;ioa_Request.io_Message.mn_ReplyPort  = AudioMP;
        AudioIO-&#062;ioa_AllocKey                         = 0;
        AudioIO-&#062;ioa_Request.io_Message.mn_Node.ln_Pri= 120;
        AudioIO-&#062;ioa_Data                             = chans;
        AudioIO-&#062;ioa_Length                           = sizeof(chans);
        }

    if (OpenDevice(AUDIONAME,0L,(struct IORequest *)AudioIO,0L) )
        printf(&#034;%s did not open\n&#034;,AUDIONAME);
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
