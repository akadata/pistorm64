<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="AutoDocs/disk" NODE="GetUnit()" TITLE="disk.resource/GetUnit" -->
<head>
<title>disk.resource/GetUnit</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Includes_and_Autodocs_2._guide/node0547.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Includes_and_Autodocs_2._guide/node0549.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->

NAME
   GetUnit - allocate the disk for a driver

SYNOPSIS
   lastDriver = GetUnit( unitPointer ), DRResource
   D0                     A1             A6

    struct <a href="../Includes_and_Autodocs_2._guide/node0119.html#line42">DiscResourceUnit</a> *GetUnit(struct <a href="../Includes_and_Autodocs_2._guide/node0119.html#line42">DiscResourceUnit</a> *);

FUNCTION
    This routine allocates the disk to a driver.  It is either
    immediately available, or the request is saved until the disk
    is available.  When it is available, your unitPointer is
    sent back to you (via ReplyMsg).  You may then reattempt the
    GetUnit.

    Allocating the disk allows you to use the disk's resources.
    <a href="../Includes_and_Autodocs_2._guide/node00D4.html#line1233">Remember</a> however that there are four units to the disk; you are
    only one of them.  Please be polite to the other units (by never
    selecting them, and by not leaving interrupts enabled, etc.).

    When you are done, please leave the disk in the following state:
        dmacon dma bit ON
        dsklen dma bit OFF (write a #DSKDMAOFF to dsklen)
        adkcon disk bits -- any way you want
        entena:disk sync and disk block interrupts -- Both DISABLED
        <a href="../Includes_and_Autodocs_2._guide/node00C7.html#line30">CIA</a> resource index interrupt -- DISABLED
        8520 outputs -- doesn't matter, because all bits will be
            set to inactive by the resource.
        8520 data direction regs -- restore to original state.

    NOTE: GetUnit() does NOT turn on the interrupts for you.
          You must use <a href="../Includes_and_Autodocs_2._guide/node0536.html">AbleICR</a> (for the index interrupt) or intena
          (for the diskbyte and diskblock interrupts) to turn them
          on.  You should turn them off before calling <a href="../Includes_and_Autodocs_2._guide/node054A.html">GiveUnit</a>,
          as stated above.

INPUTS
    unitPtr - a pointer you your disk resource unit structure.
            Note that the message filed of the structure MUST
            be a valid message, ready to be replied to.  Make sure
            ln_Name points to a null-terminated string, preferably
            one that identifies your program.

            You need to set up the three interrupt structures,
            in particular the IS_DATA and IS_CODE fields.  Set them
            to NULL if you don't need that interrupt.  Also, set
            the ln_Type of the interrupt structure to NT_INTERRUPT.
            WARNING: don't turn on a disk resource interrupt unless
            the IS_CODE for that interrupt points to executable code!

            IS_CODE will be called with IS_DATA in A1 when the
            interrupt occurs.  Preserve all regs but D0/D1/A0/A1.
            Do not make assumptions about A0.

RESULTS
    lastDriver - if the disk is not busy, then the last unit
            to use the disk is returned.  This may be used to
            see if a driver needs to reset device registers.
            (If you were the last user, then no one has changed
            any of the registers.  If someone else has used it,
            then any allowable changes may have been made).  If the
            disk is busy, then a null is returned.

EXCEPTIONS

SEE ALSO
    <a href="../Includes_and_Autodocs_2._guide/node054A.html">GiveUnit</a>

BUGS
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
