<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="AutoDocs/expansion" NODE="MakeDosNode()" TITLE="expansion.library/MakeDosNode" -->
<head>
<title>expansion.library/MakeDosNode</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Includes_and_Autodocs_2._guide/node03B7.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Includes_and_Autodocs_2._guide/node03B9.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->

NAME
    MakeDosNode -- construct dos data structures that a disk needs

SYNOPSIS
    deviceNode = MakeDosNode( parameterPkt )
    D0                        A0

    struct <a href="../Includes_and_Autodocs_2._guide/node0066.html#line100">DeviceNode</a> * MakeDosNode( void * );

FUNCTION
    This routine manufactures the data structures needed to enter
    a dos disk device into the system.  This consists of a <a href="../Includes_and_Autodocs_2._guide/node0066.html#line100">DeviceNode</a>,
    a <a href="../Includes_and_Autodocs_2._guide/node0066.html#line85">FileSysStartupMsg</a>, a disk environment vector, and up to two
    bcpl strings.  See the <a href="../Includes_and_Autodocs_2._guide/node00EB.html">libraries/dosextens.h</a> and
    libraries/filehandler.h include files for more information.

    MakeDosNode will allocate all the memory it needs, and then
    link the various structure together.  It will make sure all
    the structures are long-word aligned (as required by the DOS).
    It then returns the information to the user so he can
    change anything else that needs changing.  Typically he will
    then call <a href="../Includes_and_Autodocs_2._guide/node03B0.html">AddDosNode()</a> to enter the new device into the dos
    tables.

INPUTS
    parameterPkt - a longword array containing all the information
        needed to initialize the data structures.  Normally I
        would have provided a structure for this, but the variable
        length of the packet caused problems.  The two strings are
        null terminated strings, like all other exec strings.

        longword    description
        --------    -----------
        0           string with dos handler name
        1           string with exec device name
        2           unit number (for OpenDevice)
        3           flags (for OpenDevice)
        4           # of longwords in rest of enviroment
        5-n         file handler environment (see libraries/filehandler.h)

RESULTS
    deviceNode - pointer to initialize device node structure, or
        null if there was not enough memory.  You may need to change
        certain fields before passing the <a href="../Includes_and_Autodocs_2._guide/node0066.html#line100">DeviceNode</a> to <a href="../Includes_and_Autodocs_2._guide/node03B0.html">AddDosNode()</a>.

EXAMPLES
    /* set up a 3.5&#034; amiga format floppy drive for unit 1 */

    char execName[] = &#034;trackdisk.device&#034;;
    char dosName[] = &#034;df1&#034;;

    ULONG parmPkt[] = {
        (ULONG) dosName,
        (ULONG) execName,
        1,                  /* unit number */
        0,                  /* <a href="../Includes_and_Autodocs_2._guide/node0366.html">OpenDevice</a> flags */

        /* here is the environment block */
        16,                 /* table upper bound */
        512&#062;&#062;2,             /* # longwords in a block */
        0,                  /* sector origin -- unused */
        2,                  /* number of surfaces */
        1,                  /* secs per logical block -- leave as 1 */
        11,                 /* blocks per track */
        2,                  /* reserved blocks -- 2 boot blocks */
        0,                  /* ?? -- unused */
        0,                  /* interleave */
        0,                  /* lower cylinder */
        79,                 /* upper cylinder */
        5,                  /* number of buffers */
        MEMF_CHIP,          /* type of memory for buffers */
        (~0 &#062;&#062; 1),          /* largest transfer size (largest signed #) */
        ~1,                 /* addmask */
        0,                  /* boot priority */
        0x444f5300,         /* dostype: 'DOS0' */
    };

    struct <a href="../Includes_and_Autodocs_2._guide/node0087.html#line25">Device</a> <a href="../Includes_and_Autodocs_2._guide/node0091.html#line23">Node</a> *node, *MakeDosNode();

    node = MakeDosNode( parmPkt );


SEE ALSO
    <a href="../Includes_and_Autodocs_2._guide/node03B0.html">AddDosNode</a>, <a href="../Includes_and_Autodocs_2._guide/node00EB.html">libraries/dosextens.h</a>, libraries/filehandler.h
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
