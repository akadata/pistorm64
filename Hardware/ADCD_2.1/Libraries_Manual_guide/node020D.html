<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Libraries/Lib_12" NODE="12-1-5" TITLE="12 / OOP Overview / The Interconnection Classes" INDEX="Libraries/Lib_Index/MAIN" -->
<head>
<title>12 / OOP Overview / The Interconnection Classes</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Libraries_Manual_guide/node002C.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Libraries_Manual_guide/node020C.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Libraries_Manual_guide/node020E.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
The <a href="../Libraries_Manual_guide/node01E1.html#line98">IDCMP_IDCMPUPDATE</a> scheme presents a problem to an application that
wants to make gadgets talk to each other and talk to the application.
Boopsi gadgets only have one <a href="../Libraries_Manual_guide/node020B.html#line20">ICA_TARGET</a>.  One Boopsi gadget can talk to
either another Boopsi object or its window's IDCMP port, but not both.
Using this scheme alone would force the application to update the integer
value of the gadgets, which is what we are trying to avoid in the first
<a name="line8">place.</a>

One of the standard Boopsi classes, <a href="../Libraries_Manual_guide/node0200.html#line55">icclass</a>, is a class of information
forwarders.  An icclass object receives <a href="../Libraries_Manual_guide/node0211.html#line32">OM_UPDATE</a> messages from one object
and passes those messages on to its own <a href="../Libraries_Manual_guide/node04C9.html">ICA_TARGET</a>.  If it needs to map
<a name="line13">any incoming attributes, it can use its own <a href="../Libraries_Manual_guide/node04CA.html">ICA_MAP</a> to do so.</a>

<a href="../Libraries_Manual_guide/node0200.html#line55">Icclass</a> has a subclass called <a href="../Libraries_Manual_guide/node04CC.html">modelclass</a>.  Using a modelclass object, an
application can chain a series of these objects together to set up a
&#034;broadcast list&#034; of icclass objects.  The modelclass object is similar to
the icclass object in that it has its own <a href="../Libraries_Manual_guide/node04C9.html">ICA_TARGET</a> and <a href="../Libraries_Manual_guide/node04CA.html">ICA_MAP</a>.  It
differs in that an application can use the modelclass <a href="../Libraries_Manual_guide/node04CD.html">OM_ADDMEMBER</a> method
<a name="line20">to add icclass objects to the modelclass object's broadcast list.</a>

The <a href="../Libraries_Manual_guide/node0211.html#line48">OM_ADDMEMBER</a> method is defined by <a href="../Libraries_Manual_guide/node0200.html#line50">rootclass</a>.  It adds one Boopsi
object to the personal list of another Boopsi object.  It is up to the
Boopsi object's class to determine the purpose of the objects in the list.
Unlike the other methods mentioned so far in this chapter, OM_ADDMEMBER
does not have an Intuition function equivalent.  To pass an OM_ADDMEMBER
message to an object use the amiga.lib function <a href="../Includes_and_Autodocs_2._guide/node0157.html">DoMethodA()</a>, or its
stack-based equivalent, <a href="../Includes_and_Autodocs_2._guide/node0156.html">DoMethod()</a>:

    ULONG DoMethodA(Object *myobject, Msg boopsimessage);
    ULONG DoMethod(Object *myobject, ULONG methodID, ...);

The return value is class-dependent.  The first argument to both of these
<a name="line34">functions points to the object that will receive the Boopsi message.</a>

For <a href="../Includes_and_Autodocs_2._guide/node0157.html">DoMethodA()</a>, boopsimessage is the actual Boopsi message.  The layout
of it depends on the method.  Every method's message starts off with an
Msg (from &#060;intuition/<a href="../Includes_and_Autodocs_2._guide/node00E2.html#line24">classusr.h</a>&#062;):

    typedef struct {
        ULONG MethodID; /* Method-specific data may follow this field */
<a name="line42">    } *Msg;</a>

The message that the <a href="../Libraries_Manual_guide/node0211.html#line48">OM_ADDMEMBER</a> method uses looks like this (from
&#060;intuition/<a href="../Includes_and_Autodocs_2._guide/node00E2.html#line121">classusr.h</a>&#062;):

    struct opMember {
        ULONG    MethodID;
        Object   *opam_Object;
    };

where MethodID is <a href="../Libraries_Manual_guide/node0211.html#line48">OM_ADDMEMBER</a> and opam_Object points to the object to add
to myobject's list.

<a href="../Includes_and_Autodocs_2._guide/node0156.html">DoMethod()</a> uses the stack to build a message.  To use DoMethod(), just
pass the elements of the method's message structure as arguments to
DoMethod() in the order that they appear in the structure.  For example,
to ask the Boopsi object myobject to add the object addobject to its
personal list:

    DoMethod(myobject, OM_ADDMEMBER, addobject);

To rearrange <a href="../Libraries_Manual_guide/node0582.html">Talk2boopsi.c</a> so that it uses a <a href="../Libraries_Manual_guide/node04CC.html">modelclass</a> object (also known
as a model):

  * Create the integer and prop gadget.

  * Create the model.

  * Create two <a href="../Libraries_Manual_guide/node0200.html#line55">icclass</a> objects, one called int2prop and the other called
    prop2int.

  * Make the model the <a href="../Libraries_Manual_guide/node020B.html#line20">ICA_TARGET</a> of both the integer gadget and the prop
    gadget.  The gadgets do not need an <a href="../Libraries_Manual_guide/node020B.html#line63">ICA_MAP</a>.

  * Using <a href="../Includes_and_Autodocs_2._guide/node0156.html">DoMethod()</a> to call <a href="../Libraries_Manual_guide/node0211.html#line48">OM_ADDMEMBER</a>, add the <a href="../Libraries_Manual_guide/node0200.html#line55">icclass</a> objects to the
    model's personal list.

  * Make the prop gadget the <a href="../Libraries_Manual_guide/node04C9.html">ICA_TARGET</a> of int2prop.  Make the integer
    gadget the ICA_TARGET of prop2int.

  * Create an <a href="../Libraries_Manual_guide/node04CA.html">ICA_MAP</a> map list for int2prop that maps <a href="../Libraries_Manual_guide/node0512.html">STRINGA_LongVal</a> to
    <a href="../Libraries_Manual_guide/node050F.html">PGA_Top</a>.  Create an ICA_MAP map list for prop2int that maps PGA_Top
    to STRINGA_LongVal.  Make the <a href="../Libraries_Manual_guide/node04C9.html">ICA_TARGET</a> of the model <a href="../Libraries_Manual_guide/node020C.html#line38">ICTARGET_IDCMP</a>.

Diagrammatically, the new <a href="../Libraries_Manual_guide/node0582.html">Talk2boopsi.c</a> should look something like this:

     <a href="../Libraries_Manual_guide/node05DE.html">Figure 12-4: ICC Diagram</a> 

When either of these gadgets has some interim state change (caused by the
user manipulating the gadgets), it sends an <a href="../Libraries_Manual_guide/node0211.html#line32">OM_UPDATE</a> message to its
<a href="../Libraries_Manual_guide/node04C9.html">ICA_TARGET</a>, which in this case is the <a href="../Libraries_Manual_guide/node04CC.html">modelclass</a> object.  When this model
gets the message, it does two things.  It sends an <a href="../Libraries_Manual_guide/node01E1.html#line98">IDCMP_IDCMPUPDATE</a> to
the IDCMP port of the gadget's window and it also sends OM_UPDATE messages
to all of the objects in its personal list.  When int2prop gets an
OM_UPDATE message, it forwards that message to its ICA_TARGET, the prop
gadget.  Similarly, when prop2int gets an OM_UPDATE message, it forwards
that message to its ICA_TARGET, the integer gadget.

Although in this case it isn't a problem, <a href="../Libraries_Manual_guide/node0200.html#line55">icclass</a> and <a href="../Libraries_Manual_guide/node04CC.html">modelclass</a> objects
contain loop inhibition capabilities.  If an icclass object (or modelclass
object) receives an <a href="../Libraries_Manual_guide/node0211.html#line32">OM_UPDATE</a> message, it forwards the message to its
target.  If somehow that forwarded message gets forwarded (or broadcast)
back to the icclass object, the icclass object ignores the message.  This
prevents the possibility of an infinite OM_UPDATE loop.
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
