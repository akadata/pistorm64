<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Libraries/Lib_32" NODE="32-3-2" TITLE="32 / Expansion Board Drivers / Expansion Drivers and DOS" INDEX="Libraries/Lib_Index/MAIN" -->
<head>
<title>32 / Expansion Board Drivers / Expansion Drivers and DOS</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Libraries_Manual_guide/node002C.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Libraries_Manual_guide/node0419.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Libraries_Manual_guide/node041B.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
Two other expansion.library functions commonly used by expansion board
drivers are <a href="../Includes_and_Autodocs_2._guide/node03B8.html">MakeDosNode()</a> and <a href="../Includes_and_Autodocs_2._guide/node03B0.html">AddDosNode()</a>.  These functions allow a
driver to create and add a DOS device node (for example DH0:) to the
system.   A new function, <a href="../Includes_and_Autodocs_2._guide/node03AE.html">AddBootNode()</a>, is also available in Release 2
(V36 and later versions of the OS) that can be used to add an <a href="../Libraries_Manual_guide/node041B.html">autobooting</a>
DOS device node.

<a href="../Includes_and_Autodocs_2._guide/node03B8.html">MakeDosNode()</a> requires an initialized structure of environment information
for creating a DOS device node. The format of the function is:

    struct DeviceNode *deviceNode = MakeDosNode(parameterPkt);

The parameterPkt argument is a pointer (passed in A0 from assembler) to an
<a name="line15">initialized packet of environment parameters.</a>

The parameter packet for <a href="../Includes_and_Autodocs_2._guide/node03B8.html">MakeDosNode()</a> consists of four longwords followed
by a <a href="../Includes_and_Autodocs_2._guide/node0066.html#line28">DosEnvec</a> structure:


;-----------------------------------------------------------------------
;
; Layout of parameter packet for MakeDosNode
;
;-----------------------------------------------------------------------

* The packet for MakeDosNode starts with the following four
* longwords, directly followed by a DosEnvec structure.

    APTR  dosName    ; Points to a DOS device name (ex. 'RAM1',0)
    APTR  execName   ; Points to device driver name (ex. 'ram.device',0)
    ULONG unit       ; Unit number
    ULONG flags      ; OpenDevice flags

* The DosEnvec disk &#034;environment&#034; is a longword array that describes the
* disk geometry.  It is variable sized, with the length at the beginning.
* Here are the constants for a standard geometry.
* See libraries/filehandler.i for additional notes.

 STRUCTURE DosEnvec,0
    ULONG de_TableSize       ; Size of Environment vector
    ULONG de_SizeBlock       ; in longwords: standard value is 128
    ULONG de_SecOrg          ; not used; must be 0
    ULONG de_Surfaces        ; # of heads (surfaces). drive specific
    ULONG de_SectorPerBlock  ; not used; must be 1
    ULONG de_BlocksPerTrack  ; blocks per track. drive specific
    ULONG de_Reserved        ; DOS reserved blocks at start of partition.
    ULONG de_PreAlloc        ; DOS reserved blocks at end of partition
    ULONG de_Interleave      ; usually 0
    ULONG de_LowCyl          ; starting cylinder. typically 0
    ULONG de_HighCyl         ; max cylinder. drive specific
    ULONG de_NumBuffers      ; Initial # DOS of buffers.
    ULONG de_BufMemType      ; type of mem to allocate for buffers
    ULONG de_MaxTransfer     ; Max number of bytes to transfer at a time
    ULONG de_Mask            ; Address Mask to block out certain memory
    LONG  de_BootPri         ; Boot priority for autoboot
    ULONG de_DosType         ; ASCII (HEX) string showing filesystem type;
                             ; 0X444F5300 is old filesystem,
                             ; 0X444F5301 is fast file system
    ULONG de_Baud            ; Baud rate for serial handler
    ULONG de_Control         ; Control word for handler/filesystem
                             ; (used as filesystem/handler desires)
    ULONG de_BootBlocks      ; Number of blocks containing boot code
                             ; (for non-AmigaDOS filesystems)
    LABEL DosEnvec_SIZEOF


After making a DOS device node, drivers (except for <a href="../Libraries_Manual_guide/node041B.html">autoboot</a> drivers) use
<a href="../Includes_and_Autodocs_2._guide/node03B0.html">AddDosNode</a>(deviceNode) to add their node to the system. Autoboot drivers
will instead use the new Release 2 expansion.library <a href="../Includes_and_Autodocs_2._guide/node03AE.html">AddBootNode()</a>
function (if running under V36 or higher) or the Exec <a href="../Libraries_Manual_guide/node02E2.html">Enqueue()</a> function
(if running under pre-V36) to add a <a href="../Libraries_Manual_guide/node041D.html#line22">BootNode</a> to the
<a href="../Includes_and_Autodocs_2._guide/node00FA.html#line45">ExpansionBase.eb_MountList</a>.
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
