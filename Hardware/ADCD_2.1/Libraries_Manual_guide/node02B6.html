<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Libraries/Lib_20" NODE="20-3" TITLE="20 Exec Memory Allocation / Other Memory Functions" INDEX="Libraries/Lib_Index/MAIN" -->
<head>
<title>20 Exec Memory Allocation / Other Memory Functions</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Libraries_Manual_guide/node002C.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Libraries_Manual_guide/node02B5.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Libraries_Manual_guide/node02B7.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
<a href="../Includes_and_Autodocs_2._guide/node0330.html">Allocate()</a> and <a href="../Includes_and_Autodocs_2._guide/node0346.html">Deallocate()</a> use a memory region header, called <a href="../Includes_and_Autodocs_2._guide/node0089.html#line27">MemHeader</a>,
as part of the calling sequence.  You can build your own local header to
<a name="line4">manage memory locally. This structure takes the form:</a>

    struct MemHeader {
        struct Node       mh_Node;
        UWORD             mh_Attributes; /* characteristics of region  */
        struct  MemChunk *mh_First;      /* first free region          */
        APTR              mh_Lower;      /* lower memory bound         */
        APTR              mh_Upper;      /* upper memory bound + 1     */
        ULONG             mh_Free;       /* total number of free bytes */
    };

mh_Attributes
    is ignored by <a href="../Includes_and_Autodocs_2._guide/node0330.html">Allocate()</a> and <a href="../Includes_and_Autodocs_2._guide/node0346.html">Deallocate()</a>.

mh_First
    is the pointer to the first <a href="../Includes_and_Autodocs_2._guide/node0089.html#line19">MemChunk</a> structure.

mh_Lower
    is the lowest address within the memory block. This must be a
    multiple of eight bytes.

mh_Upper
    is the highest address within the memory block + 1.  The highest
    address will itself be a multiple of eight if the block was allocated
    to you by <a href="../Libraries_Manual_guide/node02A7.html">AllocMem()</a>.

mh_Free
    is the total free space.

This structure is included in the include files &#060;exec/<a href="../Includes_and_Autodocs_2._guide/node0089.html#line27">memory.h</a>&#062; and
&#060;exec/<a href="../Includes_and_Autodocs_2._guide/node008D.html#line70">memory.i</a>&#062;.

The following sample code fragment shows the correct initialization of a
MemHeader structure.  It assumes that you wish to allocate a block of
memory from the global pool and thereafter manage it yourself using
<a href="../Includes_and_Autodocs_2._guide/node0330.html">Allocate()</a> and <a href="../Includes_and_Autodocs_2._guide/node0346.html">Deallocate()</a>.

<a name="line41">     <a href="../Libraries_Manual_guide/node05E6.html">allocate.c</a> </a>

    How Memory Is Tagged.
    ---------------------
    Only free memory is &#034;tagged&#034; using a <a href="../Includes_and_Autodocs_2._guide/node0089.html#line19">MemChunk</a> linked list. Once
    memory is allocated, the system has no way of determining which task
<a name="line47">    now has control of that memory.</a>

If you allocate memory from the system, be sure to deallocate it when your
task exits.  You can accomplish this with matched deallocations, or by
adding a <a href="../Libraries_Manual_guide/node02B1.html">MemList</a> to your task's <a href="../Libraries_Manual_guide/node02A7.html#line5">tc_MemEntry</a>, or you can deallocate the
memory in the finalPC routine (which can be specified if you perform
<a href="../Libraries_Manual_guide/node02BC.html#line31">AddTask()</a> yourself).

 <a href="../Libraries_Manual_guide/node02B7.html">Allocating Memory at an Absolute Address</a> 
 <a href="../Libraries_Manual_guide/node02B8.html">Adding Memory to the System Pool</a> 
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
