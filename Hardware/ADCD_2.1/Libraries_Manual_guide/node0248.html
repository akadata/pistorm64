<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Libraries/Lib_14" NODE="14-5-1" TITLE="14 / Workbench and the Startup Code Module / Workbench Startup" INDEX="Libraries/Lib_Index/MAIN" -->
<head>
<title>14 / Workbench and the Startup Code Module / Workbench Startup</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Libraries_Manual_guide/node002C.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Libraries_Manual_guide/node0247.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Libraries_Manual_guide/node0249.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
When the user activates a project or tool icon, the program is run as a
separate process asynchronous to Workbench.  This allows the user to take
full advantage of the multitasking features of the Amiga.  A process is
simply a task with additional information needed to use DOS library.

When Workbench loads and starts a program, its sends the program a
<a href="../Libraries_Manual_guide/node023E.html">WBStartup</a> message containing the arguments as described earlier.  The
WBStartup also contains a pointer to the new <a href="../Libraries_Manual_guide/node0287.html#line51">Process</a> structure which
describes the execution environment of the program.  The WBStartup message
<a name="line11">is posted to the message port of the program's Process structure.</a>

The <a href="../Libraries_Manual_guide/node0287.html#line51">Process</a> message port is for the exclusive use of DOS, so this message
must be removed from the port before using any DOS library functions.
Normally this is handled by the startup code module that comes with your
compiler so you don't have to worry about this unless you are writing your
own startup code.

Standard startup code modules also set up <a href="../Libraries_Manual_guide/node0013.html#line5">SysBase</a>, the pointer to the Exec
master library, and open the DOS library setting up <a href="../Libraries_Manual_guide/node0290.html#line128">DOSBase</a>.   That is why
Exec and AmigaDOS functions can be called by C applications without first
opening a library; the startup code that applications are linked with
handles this.  Some special startups may also set up NIL: input and output
streams, or may open a stdio window so that the Workbench applications can
use stdio functions such as <a href="../Includes_and_Autodocs_2._guide/node0162.html">printf()</a>.

The startup code can tell if it is running in the Workbench environment
because the <a href="../Includes_and_Autodocs_2._guide/node0078.html#line53">pr_CLI</a> field of the <a href="../Libraries_Manual_guide/node0287.html#line51">Process</a> structure will contain NULL.  In
that case the startup code removes the <a href="../Libraries_Manual_guide/node023E.html">WBStartup</a> message from the Process
message port with <a href="../Libraries_Manual_guide/node02F2.html">GetMsg()</a> before using any functions in the DOS library.

    Do Not Use the Process Message Port for Anything Else.
    ------------------------------------------------------
    The message port in a <a href="../Libraries_Manual_guide/node0287.html#line51">Process</a> structure is for the exclusive use
    of the DOS library.

Standard startup code will pass the <a href="../Libraries_Manual_guide/node023E.html">WBStartup</a> message pointer in argv and
0 (zero) in argc if the program is started from Workbench.  These values
are pushed onto the stack, and the startup code calls the application code
that it is linked with as a function.  When the application code exits
back to the startup code, the startup code closes and frees all opens and
allocations it made.  It will then <a href="../Libraries_Manual_guide/node02D0.html#line10">Forbid()</a>, and <a href="../Libraries_Manual_guide/node02F3.html">ReplyMsg()</a> the WBStartup
message, notifying Workbench that the application <a href="../Libraries_Manual_guide/node0287.html#line51">Process</a> may be
terminated and its code unloaded from memory.

    Avoid the DOS Exit() function.
    ------------------------------
    The DOS <a href="../Includes_and_Autodocs_2._guide/node029F.html">Exit()</a> function does not return an application to the
    startup code that called it.  If you wish to exit your application,
    use the exit function provided by your startup code (usually
    lower-case exit(), or _exit for assembler), passing it a valid
    DOS return code as listed in the include file &#060;libraries/<a href="../Includes_and_Autodocs_2._guide/node0108.html">dos.h</a>&#062;.
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
