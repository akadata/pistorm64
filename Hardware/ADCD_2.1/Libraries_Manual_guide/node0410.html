<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Libraries/Lib_31" NODE="31-15" TITLE="31 Commodities Exchange Library / The IX Structure" INDEX="Libraries/Lib_Index/MAIN" -->
<head>
<title>31 Commodities Exchange Library / The IX Structure</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Libraries_Manual_guide/node002C.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Libraries_Manual_guide/node040F.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Libraries_Manual_guide/node0411.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
Commodities Exchange does not use the input event description strings
discussed earlier to match input events.  Instead, Commodities Exchange
converts these strings to its own internal format.  These input
expressions are available for commodities to use instead of the input
description strings.  The following is the IX structure as defined in
&#060;libraries/<a href="../Includes_and_Autodocs_2._guide/node00F0.html#line165">commodities.h</a>&#062;:

    #define IX_VERSION   2

    struct InputXpression {
       UBYTE   ix_Version;     /* must be set to IX_VERSION  */
       UBYTE   ix_Class;       /* class must match exactly   */
       UWORD   ix_Code;
       UWORD   ix_CodeMask;    /* normally used for UPCODE   */
       UWORD   ix_Qualifier;
       UWORD   ix_QualMask;
       UWORD   ix_QualSame;    /* synonyms in qualifier      */
       };
    typedef struct InputXpression IX;

The ix_Version field contains the current version number of the
InputXpression structure.  The current version is defined as IX_VERSION.
The ix_Class field contains the <a href="../Libraries_Manual_guide/node0407.html#line16">IECLASS_</a> constant (defined in
&#060;devices/<a href="../Includes_and_Autodocs_2._guide/node0051.html#line18">inputevent.h</a>&#062;) of the class of input event sought.  Commodities
Exchange uses the ix_Code and ix_CodeMask fields to match the ie_Code
field of a struct <a href="../Includes_and_Autodocs_2._guide/node0051.html#line196">InputEvent</a>.  The bits of ix_CodeMask indicate which bits
are relevant in the ix_Code field when trying to match against a ie_Code.
If any bits in ix_CodeMask are off, Commodities Exchange does not consider
the corresponding bit in ie_Code when trying to match input events.  This
is used primarily to mask out the <a href="../Includes_and_Autodocs_2._guide/node0051.html#line122">IECODE_UP_PREFIX</a> bit of rawkey events,
<a name="line32">making it easier to match both up and down presses of a particular key.</a>

IX's qualifier fields, ix_Qualifier, ix_QualMask, and ix_QualSame, are
used to match the ie_Qualifier field of an <a href="../Includes_and_Autodocs_2._guide/node0051.html#line196">InputEvent</a> structure.  The
ix_Qualifier and ix_QualMask fields work just like ix_Code and
ix_CodeMask.  The bits of ix_QualMask indicate which bits are relevant
when comparing ix_Qualifier to ie_Qualifier.  The ix_QualSame field tells
Commodities Exchange that certain qualifiers are equivalent:

    #define IXSYM_SHIFT  1  /* left- and right- shift are equivalent     */
    #define IXSYM_CAPS   2  /* either shift or caps lock are equivalent  */
    #define IXSYM_ALT    4  /* left- and right- alt are equivalent       */

For example, the input description string

    &#034;rawkey -caps -lalt -relativemouse -upstroke ralt tab&#034;

<a name="line49">matches a tab upstroke or downstroke with the right Alt key pressed</a>
whether or not the left Alt, either Shift, or the Caps Lock keys are down.
The following IX structure corresponds to that input description string:

    IX ix = {
        IX_VERSION,             /* The version */
        IECLASS_RAWKEY,         /* We're looking for a RAWKEY event */
        0x42,                   /* The key the usa0 keymap maps to a tab */
        0x00FF &#038; (~IECODE_UP_PREFIX), /* We want up and down key presses */
        IEQUALIFIER_RALT,             /* The right alt key must be down */
        0xFFFF &#038; ~(IEQUALIFIER_LALT | IEQUALIFIER_LSHIFT |
                   IEQUALIFIER_RSHIFT | IEQUALIFIER_CAPSLOCK |
                   IEQUALIFIER_RELATIVEMOUSE),
                   /* don't care about left alt, shift, capslock, or */
                   /* relativemouse qualifiers                       */
        IXSYM_CAPS  /* The shift keys and the capslock key */
                    /* qualifiers are all equivalent       */
<a name="line66">    };</a>

The <a href="../Libraries_Manual_guide/node0407.html">CxFilter()</a> macro only accepts a description string to describe an
input event.  A commodity can change this filter, however, with the
<a href="../Includes_and_Autodocs_2._guide/node01B3.html">SetFilter()</a> and <a href="../Includes_and_Autodocs_2._guide/node01B4.html">SetFilterIX()</a> function calls.

    void SetFilter( CxObj *filter, UBYTE *descrstring );
    void SetFilterIX( CxObj *filter, IX *ix );

<a href="../Includes_and_Autodocs_2._guide/node01B3.html">SetFilter()</a> and <a href="../Includes_and_Autodocs_2._guide/node01B4.html">SetFilterIX()</a> change which input events a <a href="../Libraries_Manual_guide/node0407.html">filter CxObject</a>
diverts.  SetFilter() accepts a pointer to an input description string.
SetFilterIX() accepts a pointer to an IX input expression.  A commodity
that uses either of these functions should check the filter's error code
<a name="line79">with <a href="../Libraries_Manual_guide/node040B.html">CxObjError()</a> to make sure the change worked.</a>

The function <a href="../Includes_and_Autodocs_2._guide/node01AF.html">ParseIX()</a> parses an input description string and translates
it into an IX input expression.

    errorcode = LONG ParseIX( UBYTE *descrstring, IX *ix );

Commodities Exchange uses <a href="../Includes_and_Autodocs_2._guide/node01AF.html">ParseIX()</a> to convert the description string in
<a href="../Libraries_Manual_guide/node0407.html">CxFilter()</a> to an IX input expression.  As was mentioned previously, as of
commodities.library version 37.3, ParseIX() does not work with certain
kinds of input strings.
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
