<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="Libraries/Lib_17" NODE="17-2" TITLE="17 Introduction to Exec / Dynamic Memory Allocation" INDEX="Libraries/Lib_Index/MAIN" -->
<head>
<title>17 Introduction to Exec / Dynamic Memory Allocation</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<a href="../Libraries_Manual_guide/node002C.html"><img src="../images/index.gif" alt="[Index]" border=0></a>
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Libraries_Manual_guide/node0287.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Libraries_Manual_guide/node0289.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
The Amiga has a soft machine architecture, meaning that all tasks,
including those that are part of its operating system, do not use fixed
memory addresses.  As a result, any program that needs to use a chunk of
<a name="line5">memory must allocate that memory from the operating system.</a>

There are two functions on the Amiga for simple memory allocation:
<a href="../Libraries_Manual_guide/node02A7.html">AllocMem()</a> and <a href="../Libraries_Manual_guide/node02A9.html#line21">AllocVec()</a>.  The two functions accept the same parameters,
a ULONG containing the size of the memory block in bytes followed by
32-bit specifier for memory attributes.  Both functions return the address
of a longword aligned memory block if they were successful or NULL if
something went wrong.

<a href="../Libraries_Manual_guide/node02A9.html#line21">AllocVec()</a> differs from <a href="../Libraries_Manual_guide/node02A7.html">AllocMem()</a> in that it records the size of the
memory block allocated so an application does not have to remember the
size of a memory block it allocated.  AllocVec() was introduced in Release
2, so it is not available to the 1.3 developer.

Normally the bitmask of memory attributes passed to these functions will
contain any of the following attributes (these flags are defined in
<a name="line21">&#060;exec/<a href="../Includes_and_Autodocs_2._guide/node0089.html#line66">memory.h</a>&#062;):</a>

MEMF_ANY
    This indicates that there is no requirement for either Fast or Chip
    memory.  In this case, while there is Fast memory available, Exec
    will only allocate Fast memory.  Exec will allocate Chip memory if
<a name="line27">    there is not enough Fast memory.</a>

MEMF_CHIP
    This indicates the application wants a block of Chip memory, meaning
    it wants memory addressable by the Amiga custom chips.  Chip memory
    is required for any data that will be accessed by custom chip DMA.
    This includes floppy disk buffers, screen memory, images that will be
    blitted, sprite data, copper lists, and audio data.  If your
    application requires a block of Chip RAM, it must use this flag to
    allocate the Chip RAM.  Otherwise, the application will fail on
<a name="line37">    machines with expanded memory.</a>

MEMF_FAST
    This indicates a memory block outside of the range that the Amiga's
    custom chips can access.  The &#034;FAST&#034; in MEMF_FAST has to do with the
    custom chips and the CPU trying to access the same memory at the same
    time.  Because the custom chips and the CPU both have access to Chip
    RAM, the CPU may have to wait to access Chip RAM while some custom
    chip is reading or writing Chip RAM.  In the case of Fast RAM, the
    custom chips do not have access to it, so the CPU does not have to
    contend with the custom chips access to Fast RAM, making CPU accesses
    to Fast RAM generally faster than CPU access to Chip RAM.

    Since the flag specifies memory that the custom chips cannot access,
    this flag is mutually exclusive with the MEMF_CHIP flag.  If you
    specify the MEMF_FAST flag, your allocation will fail on Amigas that
<a name="line53">    have only Chip memory.  Use MEMF_ANY if you would prefer Fast memory.</a>

MEMF_PUBLIC
    This indicates that the memory should be accessible to other tasks.
    Although this flag doesn't do anything right now, using this flag
    will help ensure compatibility with possible future features of the
<a name="line59">    OS (like virtual memory and memory protection).</a>

MEMF_CLEAR
<a name="line62">    This indicates that the memory should be initialized with zeros.</a>

If an application does not specify any attributes when allocating memory,
the system first looks for MEMF_FAST, then MEMF_CHIP.  There are
additional memory allocation flags for Release 2: <a href="../Libraries_Manual_guide/node02A8.html#line40">MEM_LOCAL</a>, <a href="../Libraries_Manual_guide/node02A8.html#line44">MEMF_24BITDMA</a>
and <a href="../Libraries_Manual_guide/node02A8.html#line50">MEMF_REVERSE</a>.  See the Exec Autodoc for <a href="../Includes_and_Autodocs_2._guide/node0332.html">AllocMem()</a> in the Amiga ROM
Kernel Reference Manual: Includes and Autodocs or the include file
&#060;exec/<a href="../Includes_and_Autodocs_2._guide/node0089.html#line66">memory.h</a>&#062; for additional information on these flags.  Use of these
flags under earlier versions of the operating system will cause your
allocation to fail.

    Make Sure You Have Memory.
    --------------------------
    Always check the result of any memory allocation to be sure the type
    and amount of memory requested is available.  Failure to do so will
<a name="line77">    lead to trying to use an non-valid pointer.</a>

When an application is finished with a block of memory it allocated, it
must return it to the operating system.  There is a function to return
memory for both the <a href="../Libraries_Manual_guide/node02A7.html">AllocMem()</a> and the <a href="../Libraries_Manual_guide/node02A9.html#line21">AllocVec()</a> functions.  <a href="../Libraries_Manual_guide/node02A7.html#line11">FreeMem()</a>
releases memory allocated by AllocMem().

It takes two parameters, a pointer to a memory block and the size of the
memory block.  <a href="../Libraries_Manual_guide/node02A7.html#line11">FreeVec()</a> releases memory allocated by <a href="../Libraries_Manual_guide/node02A9.html#line21">AllocVec()</a>.  It
takes only one parameter, a pointer to a memory block allocated by
AllocVec().  The following example shows how to allocate and deallocate
memory.

    APTR  my_mem;

    if (my_mem = AllocMem(100, MEMF_ANY))
    {
        /* Your code goes here */
        FreeMem(my_mem, 100);
    }
    else  { /* couldn't get memory, exit with an error */ }
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
