<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/39.2 FILE="exec" NODE="CachePreDMA()" TITLE="exec.library/CachePreDMA" -->
<head>
<title>exec.library/CachePreDMA</title>
</head>
<body text="#000000" bgcolor="#AAAAAA">
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Includes_and_Autodocs_3._guide/node01F2.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Includes_and_Autodocs_3._guide/node01F4.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->

<b>   NAME</b>
	CachePreDMA - Take actions prior to hardware DMA  (V37)

<b>   SYNOPSIS</b>
	paddress = CachePreDMA(vaddress,&#038;length,flags)
	d0                     a0       a1      d0

	<a href="../Includes_and_Autodocs_3._guide/node0654.html#line37">APTR</a> CachePreDMA(APTR,<a href="../Includes_and_Autodocs_3._guide/node0654.html#line39">LONG</a> *,ULONG);

<b>   FUNCTION</b>
	Take all appropriate steps before Direct Memory Access (DMA).  This
	function is primarily intended for writers of DMA device drivers.  The
	action will depend on the CPU type installed, caching modes, and the
	state of any Memory Management <a href="../Includes_and_Autodocs_3._guide/node05FB.html#line30">Unit</a> (MMU) activity.

	This function supports advanced cache architectures that have
	&#034;copyback&#034; modes.  With copyback, write data may be cached, but not
	actually flushed out to memory.  If the CPU has unflushed data at the
	time of DMA, data may be lost.

	As implemented
		68000 - Do nothing
		68010 - Do nothing
		68020 - Do nothing
		68030 - Do nothing
		68040 - <a href="../Includes_and_Autodocs_3._guide/node01D1.html">Write</a> any matching dirty cache lines back to memory.
			As a side effect of the 68040's design, matching data
			cache lines are also invalidated -- future CPUs may
			be different.
		????? - External cache boards, Virtual Memory Systems, or
			future hardware may patch this vector to best emulate
			the intended behavior.
			With a Bus-Snooping CPU, this function my end up
			doing nothing.

<b>   INPUTS</b>
	address	- Base address to start the action.
	length	- Pointer to a longword with a length.
	flags	- Values:
			DMA_Continue - Indicates this call is to complete
			a prior request that was broken up.

			DMA_ReadFromRAM - Indicates that this DMA is a
			read from RAM to the DMA device (ie - a write
			to the hard drive)  This flag is not required
			but if used must match in both the PreDMA and
			PostDMA calls.  This flag *should* be used to
			help the system provide the best performance.
			This flag is safe in all versions of CachePreDMA()

<b>   RESULTS</b>
	paddress- Physical address that corresponds to the input virtual
		  address.
	&#038;length	- This length value will be updated to reflect the contiguous
		  length of physical memory present at paddress.  This may
		  be smaller than the requested length.  To get the mapping
		  for the next chunk of memory, call the function again with
		  a new address, length, and the DMA_Continue flag.

<b>   NOTE</b>
	Due to processor granularity, areas outside of the address range
	may be affected by the cache flushing actions.  Care has been taken
	to ensure that no harm is done outside the range, and that activities
	on overlapping cache lines won't harm data.

<b>   SEE ALSO</b>
	exec/execbase.i, <a href="../Includes_and_Autodocs_3._guide/node01F2.html">CachePostDMA()</a>, <a href="../Includes_and_Autodocs_3._guide/node01F0.html">CacheClearU()</a>, <a href="../Includes_and_Autodocs_3._guide/node01EF.html">CacheClearE()</a>
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
