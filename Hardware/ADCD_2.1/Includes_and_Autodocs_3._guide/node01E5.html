<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/39.2 FILE="exec" NODE="Allocate()" TITLE="exec.library/Allocate" -->
<head>
<title>exec.library/Allocate</title>
</head>
<body text="#000000" bgcolor="#AAAAAA">
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Includes_and_Autodocs_3._guide/node01E4.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Includes_and_Autodocs_3._guide/node01E6.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->

<b>   NAME</b>
	Allocate - allocate a block of memory

<b>   SYNOPSIS</b>
	memoryBlock=Allocate(memHeader, byteSize)
	D0		     A0 	D0

	void *Allocate(struct <a href="../Includes_and_Autodocs_3._guide/node062D.html#line27">MemHeader</a> *, ULONG);

<b>   FUNCTION</b>
	This function is used to allocate blocks of memory from a given
	private free memory pool (as specified by a <a href="../Includes_and_Autodocs_3._guide/node062D.html#line27">MemHeader</a> and its
	memory chunk list).  Allocate will return the first free block that
	is greater than or equal to the requested size.

	All blocks, whether free or allocated, will be block aligned;
	hence, all allocation sizes are rounded up to the next block even
	value (e.g. the minimum allocation resolution is currently 8
	bytes.  A request for 8 bytes will use up exactly 8 bytes.  A
	request for 7 bytes will also use up exactly 8 bytes.).

	This function can be used to manage an application's internal data
	memory.  Note that no arbitration of the <a href="../Includes_and_Autodocs_3._guide/node062D.html#line27">MemHeader</a> and associated
	free chunk list is done.  You must be the owner before calling
	Allocate.

<b>   INPUTS</b>
	memHeader - points to the local memory list header.
	byteSize - the size of the desired block in bytes.

<b>   RESULT</b>
	memoryBlock - a pointer to the just allocated free block.
	       If there are no free regions large enough to satisfy the
	       request, return zero.

<b>   EXAMPLE</b>
	#include <a href="../Includes_and_Autodocs_3._guide/node0654.html">&#060;exec/types.h&#062;</a>
	#include <a href="../Includes_and_Autodocs_3._guide/node062D.html">&#060;exec/memory.h&#062;</a>
	void *AllocMem();
	#define BLOCKSIZE 4096L /* Or whatever you want */

	void main()
	{
	struct <a href="../Includes_and_Autodocs_3._guide/node062D.html#line27">MemHeader</a> *mh;
	struct <a href="../Includes_and_Autodocs_3._guide/node062D.html#line19">MemChunk</a>  *mc;
	<a href="../Includes_and_Autodocs_3._guide/node0654.html#line37">APTR</a>   block1;
	<a href="../Includes_and_Autodocs_3._guide/node0654.html#line37">APTR</a>   block2;

	    /* Get the <a href="../Includes_and_Autodocs_3._guide/node062D.html#line27">MemHeader</a> needed to keep track of our new block */
	    mh = (struct <a href="../Includes_and_Autodocs_3._guide/node062D.html#line27">MemHeader</a> *)
		 AllocMem((long)sizeof(struct MemHeader), MEMF_CLEAR );
	    if( !mh )
		exit(10);

	    /* Get the actual block the above <a href="../Includes_and_Autodocs_3._guide/node062D.html#line27">MemHeader</a> will manage */
	    mc = (struct <a href="../Includes_and_Autodocs_3._guide/node062D.html#line19">MemChunk</a> *)AllocMem( BLOCKSIZE, 0L );
	    if( !mc )
		{
		FreeMem( mh, (long)sizeof(struct MemHeader) ); exit(10);
		}

	    mh-&#062;mh_Node.ln_Type = NT_MEMORY;
	    mh-&#062;mh_Node.ln_Name = &#034;myname&#034;;
	    mh-&#062;mh_First = mc;
	    mh-&#062;mh_Lower = (APTR) mc;
	    mh-&#062;mh_Upper = (APTR) ( BLOCKSIZE + (ULONG) mc );
	    mh-&#062;mh_Free  = BLOCKSIZE;

	    /* Set up first chunk in the freelist */
	    mc-&#062;mc_Next  = NULL;
	    mc-&#062;mc_Bytes = BLOCKSIZE;

	    block1 = (APTR) Allocate( mh, 20L );
	    block2 = (APTR) Allocate( mh, 314L );
	    printf(&#034;mh=$%lx mc=$%lxn&#034;,mh,mc);
	    printf(&#034;Block1=$%lx, Block2=$%lxn&#034;,block1,block2);

	    FreeMem( mh, (long)sizeof(struct MemHeader) );
	    FreeMem( mc, BLOCKSIZE );
	}

<b>   NOTE</b>
	If the free list is corrupt, the system will panic with alert
	AN_MemCorrupt, $01000005.

<b>   SEE ALSO</b>
	<a href="../Includes_and_Autodocs_3._guide/node01FE.html">Deallocate()</a>, <a href="../Includes_and_Autodocs_3._guide/node062D.html">exec/memory.h</a>
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
