<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/39.2 FILE="keymap" NODE="MapANSI()" TITLE="keymap.library/MapANSI" -->
<head>
<title>keymap.library/MapANSI</title>
</head>
<body text="#000000" bgcolor="#AAAAAA">
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../Includes_and_Autodocs_3._guide/node0410.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../Includes_and_Autodocs_3._guide/node0412.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->

<b>   NAME</b>
	MapANSI -- Encode an ANSI string into keycodes. (V36)

<b>   SYNOPSIS</b>
	actual = MapANSI( string, count, buffer, length, keyMap )
	D0                A0      D0     A1      D1      A2

	<a href="../Includes_and_Autodocs_3._guide/node0654.html#line39">LONG</a> MapANSI( <a href="../Includes_and_Autodocs_3._guide/node0654.html#line57">STRPTR</a>, <a href="../Includes_and_Autodocs_3._guide/node0654.html#line39">LONG</a>, <a href="../Includes_and_Autodocs_3._guide/node0654.html#line57">STRPTR</a>, <a href="../Includes_and_Autodocs_3._guide/node0654.html#line39">LONG</a>, struct <a href="../Includes_and_Autodocs_3._guide/node0623.html#line20">KeyMap</a> * );

<b>   FUNCTION</b>
	This console function converts an ANSI byte string to the
	code/qualifier pairs of type IECLASS_RAWKEY that would
	generate the string and places those pairs in a buffer.
	A code/qualifier pair is a pair of bytes suitable for
	putting in the ie_Code and low byte of ie_Qualifier,
	and for subsequent events, shifted to the ie_Prev1DownCode/
	ie_Prev1DownQual then ie_Prev2DownCode/ie_Prev2DownQual
	pairs for any dead or double dead key mapping.


<b>   INPUTS</b>
	string - the ANSI string to convert.
	count - the number of characters in the string.
	buffer - a byte buffer large enough to hold all anticipated
	    code/qualifier pairs generated by this conversion.
	length - maximum anticipation, i.e. the buffer size in bytes
	    divided by two (the size of the code/qualifier pair).
	keyMap - a <a href="../Includes_and_Autodocs_3._guide/node0623.html#line20">KeyMap</a> structure pointer, or null if the default
	    key map is to be used.

<b>   RESULT</b>
	actual - the number of code/qualifier pairs in the buffer,
	    or negative to describe an error (see below).

<b>   EXAMPLE</b>
	...
	#include <a href="../Includes_and_Autodocs_3._guide/node061A.html">&#060;devices/inputevent.h&#062;</a>

	#define	STIMSIZE	3	/* two dead keys, one key */
	unsigned char rBuffer[STIMSIZE*2];
	...
	    KeymapBase = (struct <a href="../Includes_and_Autodocs_3._guide/node0626.html#line33">Library</a> *) OpenLibrary(&#034;keymap.library&#034;, 0);
	    ...
	    event.ie_NextEvent = 0;
	    event.ie_Class = IECLASS_RAWKEY;
	    event.ie_SubClass = 0;

	    /* prove keymap code completeness and MapANSI reversibility */
	    for (code = 0; code &#060; 256; code++) {
		buffer[0] = code;
		actual = MapANSI(buffer, 1, rBuffer, STIMSIZE, 0);
		r = rBuffer;
		event.ie_Prev2DownCode = 0;
		event.ie_Prev2DownQual = 0;
		event.ie_Prev1DownCode = 0;
		event.ie_Prev1DownQual = 0;
		switch (actual) {
		    case -2:
			printf(&#034;MapANSI internal error&#034;);
			goto reportChar;
		    case -1:
			printf(&#034;MapANSI overflow error&#034;);
			goto reportChar;
		    case 0:
			printf(&#034;MapANSI ungeneratable code&#034;);
			goto reportChar;

		    case 3:
			event.ie_Prev2DownCode = *r++;
			event.ie_Prev2DownQual = *r++;
		    case 2:
			event.ie_Prev1DownCode = *r++;
			event.ie_Prev1DownQual = *r++;
		    case 1:
			event.ie_Code = *r++;
			event.ie_Qualifier = *r;

			actual = MapRawKey(&#038;event, buffer, BUFFERLEN, 0);
			if ((actual != 1) || (buffer[0] != code)) {
			    printf(&#034;MapANSI not reversible&#034;);
			    for (i = 0; i &#060; actual; i++)
				ReportChar(buffer[i]);
			    printf(&#034; from&#034;);
	reportChar:
			    ReportChar(code);
			    printf(&#034;n&#034;);
			}
		}
	    }
	...

<b>   ERRORS</b>
	if actual is 0, a character in the string was not generatable
	    from the keyMap.
	if actual is -1, a buffer overflow condition was detected.
	if actual is -2, an internal error occurred (e.g. no memory)

<b>   SEE ALSO</b>
	<a href="../Includes_and_Autodocs_3._guide/node061A.html">devices/inputevent.h</a>, <a href="../Includes_and_Autodocs_3._guide/node0623.html">devices/keymap.h</a>
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
