<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="IV-41/imageclass.txt" NODE="IV-41-5" TITLE="OM_NEW" -->
<head>
<title>OM_NEW</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../AmigaMail_Vol2_guide/node00A2.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../AmigaMail_Vol2_guide/node00A4.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
The OM_NEW method receives the following arguments:

    struct opSet
    {
        ULONG MethodID;
        struct TagItem *ops_AttrList;
        struct GadgetInfo *ops_GInfo;
    };

The ops_AttrList field contains a pointer to the TagItem array of
attributes for the new object.  The ops_GInfo field is always NULL for the
OM_NEW method.

Unlike other methods, this method is not passed an object pointer (since
the whole idea is to create an object).  The pointer normally used to pass
a boopsi object is instead used to pass the address of the object's &#034;true
class&#034; (the class the object is an instance of).  That way, all class
dispatchers can tell if they are the &#034;true class&#034; of the object being
created (as opposed to a superclass of the true class).  Also, with this
pointer, rootclass can determine what the instance data is for an object,
and can allocate the right amount of memory for it.

For the OM_NEW method, the new class's dispatcher should do the following:

1) Pass the message along to the superclass.  All classes do this as
   rootclass takes care of allocating memory for the new object.  As the
   OM_NEW method works &#034;top down&#034; (from rootclass down through its
   subclasses to the true class), each class will in turn initialize its
   corresponding instance data.  This all happens before the new class's
   dispatcher regains control.  Eventually, the message comes back from
   the superclass with a newly allocated object (unless of course
   something failed and you receive a NULL pointer instead).

2) Obtain a pointer to the object's instance data for this class.  Use the
   INST_DATA() macro (defined in &#060;intuition/classes.h&#062;).  INST_DATA()
   takes two arguments, a pointer to your class and a pointer to the
   object.

       void *INST_DATA(*Class, *Object);

3) Initialize your instance data.  You may allocate additional memory
   buffers for your object, or even create other objects which are
   components to objects of your class.

4) Process your initial attribute list (from the opSet structure passed in
   the OM_NEW message).  In particular, process all the attributes that
   can be set only at initialization time.  After you deal with the
   &#034;initialization only&#034; attributes, apply the same attribute processing
   on these remaining attributes that you would apply to an OM_SET
   message.

5) Return the object to the caller.
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
