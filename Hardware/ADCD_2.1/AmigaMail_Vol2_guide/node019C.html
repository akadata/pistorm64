<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="IV-3/Lockpub.c" NODE="MAIN" TITLE="IV-3/Lockpub.c" -->
<head>
<title>IV-3/Lockpub.c</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../AmigaMail_Vol2_guide/node019B.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../AmigaMail_Vol2_guide/node019D.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
/*
 * V36 Lock public screen list example
 *
 * Compiled with SAS/C 6.56:  sc NMINC STRMERGE NOSTKCHK LINK lockpub.c
 * Use V36 include files.
 *
 * Copyright (c) 1990-1999 Amiga, Inc.
 *
 * This example is provided in electronic form by Amiga,
 * Inc. for use with the Amiga Mail Volume II technical publication.
 * Amiga Mail Volume II contains additional information on the correct
 * usage of the techniques and operating system functions presented in
 * these examples.  The source and executable code of these examples may
 * only be distributed in free electronic form, via bulletin board or
 * as part of a fully non-commercial and freely redistributable
 * diskette.  Both the source and executable code (including comments)
 * must be included, without modification, in any copy.  This example
 * may not be published in printed form or distributed with any
 * commercial product. However, the programming techniques and support
 * routines set forth in these examples may be used in the development
 * of original executable software products for Amiga
 * computers.
 *
 * All other rights reserved.
 *
 * This example is provided &#034;as-is&#034; and is subject to change; no
 * warranties are made.  All use is at your own risk. No liability or
 * responsibility is assumed.
 *
 */

#include &#060;string.h&#062;

#include &#060;intuition/intuition.h&#062;
#include &#060;intuition/screens.h&#062;
#include &#060;exec/memory.h&#062;
#include &#060;exec/lists.h&#062;

#include &#060;clib/intuition_protos.h&#062;
#include &#060;clib/exec_protos.h&#062;
#include &#060;clib/alib_protos.h&#062;

void main (void);

struct IntuitionBase *IntuitionBase;

void main(void)
{

    struct List *publist;
    struct List *copy_publist;
    struct PubScreenNode *psnode;
    struct PubScreenNode *copy_psnode;

    /* fails silently if not V36 */
    if (IntuitionBase = OpenLibrary(&#034;intuition.library&#034;, 36)) {
        if (copy_publist = AllocMem(sizeof(struct List), MEMF_CLEAR)) {
            NewList(copy_publist);

            /* Lock the public screen list */
            publist = LockPubScreenList();

            /* and copy it */
            for (psnode = (struct PubScreenNode *)publist-&#062;lh_Head;
                     psnode-&#062;psn_Node.ln_Succ;
                     psnode = (struct PubScreenNode *)psnode-&#062;psn_Node.ln_Succ) {
                if (copy_psnode = AllocMem(sizeof(struct PubScreenNode), MEMF_CLEAR)) {
                    /* Copy the structure */
                    *copy_psnode = *psnode;

                    /* ln_Name points to the public screen name, make your own copy */
                    if (copy_psnode-&#062;psn_Node.ln_Name =
                            AllocMem(strlen(psnode-&#062;psn_Node.ln_Name) + 1, MEMF_CLEAR))
                        strcpy(copy_psnode-&#062;psn_Node.ln_Name, psnode-&#062;psn_Node.ln_Name);
                    else
                        printf(&#034;Not enough memory to copy screen name\n&#034;);

                    AddTail(copy_publist, (struct Node *)copy_psnode);
                } else {
                    printf(&#034;out of memory\n&#034;);
                    break;
                }
           }
           UnlockPubScreenList();

           psnode = (struct PubScreenNode *)copy_publist-&#062;lh_Head;
           while (copy_psnode = (struct PubScreenNode *)psnode-&#062;psn_Node.ln_Succ) {
                printf(&#034;%s\n&#034;, psnode-&#062;psn_Node.ln_Name);

                printf(&#034;psn_Screen       0x%lx\n&#034;, psnode-&#062;psn_Screen);
				                                               /* a pointer to the public screen */
                printf(&#034;psn_Flags        0x%lx\n&#034;, psnode-&#062;psn_Flags);
				                                               /* the flags */
                printf(&#034;psn_VisitorCount %ld\n&#034;, psnode-&#062;psn_VisitorCount);
                                                               /* the number of visitorwindows */
                printf(&#034;psn_SigTask      0x%lx\n&#034;, psnode-&#062;psn_SigTask);
				                                               /* The task to signal when the */
                                                               /* visitor is gone */
                printf(&#034;psn_SigBit       %ld\n\n&#034;, psnode-&#062;psn_SigBit);
				                                               /* The signalbit number to use */
                                                               /* to signal the task */

                if (psnode-&#062;psn_Node.ln_Name)
                    FreeMem(psnode-&#062;psn_Node.ln_Name, strlen(psnode-&#062;psn_Node.ln_Name) + 1);
                Remove((struct Node *)psnode);
                FreeMem(psnode, sizeof(struct PubScreenNode));
                psnode = copy_psnode;
           }
           FreeMem(copy_publist, sizeof(struct List));
        }
        CloseLibrary(IntuitionBase);
    }
}
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
