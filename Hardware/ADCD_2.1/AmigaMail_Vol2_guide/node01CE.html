<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<!-- AG2HTML: CONVERTER=AG2HTML/1.1 FORMAT=AMIGAGUIDE/34.11 FILE="V-39/NameMode.c" NODE="MAIN" TITLE="V-39/NameMode.c" -->
<head>
<title>V-39/NameMode.c</title>
</head>
<body>
<img src="../images/toc_d.gif" alt="[Contents]">
<img src="../images/index_d.gif" alt="[Index]">
<img src="../images/help_d.gif" alt="[Help]">
<img src="../images/retrace_d.gif" alt="[Retrace]">
<a href="../AmigaMail_Vol2_guide/node01CD.html"><img src="../images/prev.gif" alt="[Browse &#060;]" border=0></a>
<a href="../AmigaMail_Vol2_guide/node01CF.html"><img src="../images/next.gif" alt="[Browse &#062;]" border=0></a>
<hr>
<pre>
<!-- AG2HTML: BODY=START -->
#include &#060;exec/types.h&#062;
#include &#060;graphics/displayinfo.h&#062;
#include &#060;stdio.h&#062;
#include &#060;string.h&#062;

#include &#060;clib/graphics_protos.h&#062;
#include &#060;clib/utility_protos.h&#062;

/*****************************************************************************/

#define MONITOR_PART(id) ((id) &#038; MONITOR_ID_MASK)

/*****************************************************************************/

BOOL NameMode (ULONG modeID, STRPTR result)
{
  struct NameInfo nameInfo;
  struct DisplayInfo dispInfo;
  struct DimensionInfo dimInfo;
  struct MonitorInfo monInfo;
  char buffer[DISPLAYNAMELEN + 1];
  UWORD len;
  DisplayInfoHandle dh;

  result[0] = 0;

  dh = FindDisplayInfo (modeID);
  if (GetDisplayInfoData (dh, (APTR) &#038; dispInfo, sizeof (struct DisplayInfo),
                          DTAG_DISP, INVALID_ID), INVALID_ID)
  {
    if (!dispInfo.NotAvailable)
    {
      if (GetDisplayInfoData (dh, (APTR) &#038; dimInfo, sizeof (struct DimensionInfo),
                              DTAG_DIMS, INVALID_ID))
      {
	/* Get name or make one if no name available */
	if (GetDisplayInfoData (dh, (APTR) &#038; nameInfo, sizeof (struct NameInfo),
	                        DTAG_NAME, INVALID_ID))
	{
	  strcpy (result, nameInfo.Name);
	  return (TRUE);
	}
	else
	{
	  if (GetDisplayInfoData (dh, (APTR) &#038; monInfo, sizeof (struct MonitorInfo),
	                          DTAG_MNTR, INVALID_ID))
	  {
	    if ((monInfo.Mspc) &#038;&#038; (monInfo.Mspc-&#062;ms_Node.xln_Name))
	    {
	      strcpy (buffer, monInfo.Mspc-&#062;ms_Node.xln_Name);
	      len = strlen (buffer);
	      if ((len &#062; 8) &#038;&#038; (Strnicmp (&#038;buffer[len - 8], &#034;.monitor&#034;, len - 8)
	                                                                     == 0))
	      {
		buffer[len - 8] = 0;
		len -= 8;
	      }

	      while (len &#062; 0)
		buffer[--len] = ToUpper (buffer[len]);
	    }
	  }

	  sprintf (result, &#034;%s:%lu x %lu %s%s%s&#034;,
		   buffer,
		   (dimInfo.Nominal.MaxX - dimInfo.Nominal.MinX + 1),
		   (dimInfo.Nominal.MaxY - dimInfo.Nominal.MinY + 1),
		   (dispInfo.PropertyFlags &#038; DIPF_IS_HAM) ? &#034;HAM &#034; :
		   (dispInfo.PropertyFlags &#038; DIPF_IS_EXTRAHALFBRITE) ? &#034;EHB &#034; : &#034;&#034;,
		   (dispInfo.PropertyFlags &#038; DIPF_IS_PF2PRI) ? &#034;DPF2 &#034; :
		   (dispInfo.PropertyFlags &#038; DIPF_IS_DUALPF) ? &#034;DPF &#034; : &#034;&#034;,
		   (dispInfo.PropertyFlags &#038; DIPF_IS_LACE) ? &#034;Laced &#034; : &#034;&#034;, &#034;&#034;);

	  return (TRUE);
	}
      }
    }
  }

  return (FALSE);
}

/*****************************************************************************/

void main (void)
{
  ULONG modeID;
  char name[64];

  modeID = INVALID_ID;
  while ((modeID = NextDisplayInfo (modeID)) != INVALID_ID)
  {
    if (MONITOR_PART (modeID))	/* ignore &#034;default&#034; monitor */
    {
      if (NameMode (modeID, name))
      {
	printf (&#034;%s\n&#034;, name);
      }
    }
  }
}
<!-- AG2HTML: BODY=END -->
</pre>

<!-- [amigadev.elowar.com] Automatically generated content... -->
<hr />
<pre>[Back to <a href="http://amigadev.elowar.com/">Amiga Developer Docs</a>]</pre>
<!-- [amigadev.elowar.com] End of automatically generated content. -->

</body>
</html>
