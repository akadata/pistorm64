SOURCE: AmigaMail_Vol2_guide/node0180.html
TITLE: II-87/ExRecLock1.c

II-87/ExRecLock1.c ]" border=0> ;/* ExRecLock1.c - Execute me to compile me with SAS/C 6.56 sc DATA=NEAR NMINC STRMERGE STREQ NOSTKCHK SAVEDS IGNORE=73 ExRecLock1.c slink FROM LIB:c.o,ExRecLock1.o TO ExRecLock1 LIBRARY LIB:sc.lib,LIB:amiga.lib quit ;*/ /* (c) Copyright 1992-1999 Amiga, Inc. All rights reserved. The information contained herein is subject to change without notice, and is provided "as is" without warranty of any kind, either expressed or implied. The entire risk as to the use of this information is assumed by the user. */ /* This is a simple example of using record locking to create an exclusive record */ /* lock on a file, and writing to that record. The example ExRecLock2 is almost */ /* exactly the same as this example, except ExRecLock2 uses the record lock directly */ /* after ExRecLock1's record. If you try to run ExRecLock1 (or ExRecLock2) while */ /* another instance of ExRecLock1 (or ExRecLock2) is running, the second record lock */ /* attempt will fail. */ #include #include #include #ifdef LATTICE int CXBRK(void) { return(0); } /* Disable Lattice CTRL/C handling */ void chkabort(void) { return; } #endif #define RECORDSIZE 12 #define RECORDOFFSET 0 extern struct Library *DOSBase; UBYTE *vers = "\0$VER: ExRecLock1 37.2"; UBYTE *string = "ExRecLock1\n"; /* This string will be the */ /* contents of the record. */ void main(void) { BPTR fh; if (DOSBase->lib_Version >= 37) /* Record locking was introduced in Release 2, */ { /* but the standard startup code will open any */ /* version of dos.library, so we have to ex- */ /* plicitly check the version number of DOS. */ if (fh = Open("t:testRLock", MODE_READWRITE)) /* Open the file, creating */ { /* it if necessary. */ if (DOSTRUE == LockRecord(fh, /* Lock the record as exclusive, */ RECORDOFFSET, /* and do not wait if it is not */ RECORDSIZE, /* available immediately. */ REC_EXCLUSIVE_IMMED, 0)) { LONG error = RECORDOFFSET; /* If the record is beyond the end of the file, */ if (Seek(fh, 0, OFFSET_END) [Back to Amiga Developer Docs ]
