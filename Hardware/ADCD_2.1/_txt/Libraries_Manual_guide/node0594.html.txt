SOURCE: Libraries_Manual_guide/node0594.html
TITLE: Lib_examples/Diag.asm

Lib_examples/Diag.asm ]" border=0> ** ** Sample autoboot code fragment ** ** These are the calling conventions for the Diag routine ** ** A7 -- points to at least 2K of stack ** A6 -- ExecBase ** A5 -- ExpansionBase ** A3 -- your board's ConfigDev structure ** A2 -- Base of diag/init area that was copied ** A0 -- Base of your board ** ** Your Diag routine should return a non-zero value in D0 for success. ** If this value is NULL, then the diag/init area that was copied ** will be returned to the free memory pool. ** INCLUDE "exec/types.i" INCLUDE "exec/nodes.i" INCLUDE "exec/resident.i" INCLUDE "libraries/configvars.i" ; LVO's resolved by linking with library amiga.lib XREF _LVOFindResident ROMINFO EQU 1 ROMOFFS EQU $0 * ROMINFO defines whether you want the AUTOCONFIG information in * the beginning of your ROM (set to 0 if you instead have PALS * providing the AUTOCONFIG information instead) * * ROMOFFS is the offset from your board base where your ROMs appear. * Your ROMs might appear at offset 0 and contain your AUTOCONFIG * information in the high nibbles of the first $40 words ($80 bytes). * Or, your autoconfig ID information may be in a PAL, with your * ROMs possibly being addressed at some offset (for example $2000) * from your board base. This ROMOFFS constant will be used as an * additional offset from your configured board address when patching * structures which require absolute pointers to ROM code or data. *----- We'll store Version and Revision in serial number VERSION EQU 37 ; also the high word of serial number REVISION EQU 1 ; also the low word of serial number * See the Addison-Wesley Amiga Hardware Manual for more info. MANUF_ID EQU 2011 ; CBM assigned (2011 for hackers only) PRODUCT_ID EQU 1 ; Manufacturer picks product ID BOARDSIZE EQU $40000 ; How much address space board decodes SIZE_FLAG EQU 3 ; Autoconfig 3-bit flag for BOARDSIZE ; 0=$800000(8meg) 4=$80000(512K) ; 1=$10000(64K) 5=$100000(1meg) ; 2=$20000(128K) 6=$200000(2meg) ; 3=$40000(256K) 7=$400000(4meg) CODE ******* RomStart *************************************************** ********************************************************************** RomStart: IFGT ROMINFO ; ; ExpansionRom structure ; ; Note - If you implement your ExpansionRom and ExpansionControl ; with PALS, then you can comment out everything until DiagStart: ; (ie. Make ROMID EQU 0) * ; High nibbles of first two words ($00,$02) are er_Type (not inverted) ; er_Type dc.w $D000 ; 11xx normal board type ; xx0x not in memory free list ; xxx1 Diag valid (has driver) dc.w (SIZE_FLAG [Back to Amiga Developer Docs ]
