Lib_examples/divert.c ]" border=0> ;/* divert.c - commodity to monitor user inactivity - compiled with SASC 5.10 LC -b0 -cfist -v -j73 divert.c Blink FROM LIB:c.o,divert.o TO divert LIBRARY LIB:LC.lib,LIB:Amiga.lib NODEBUG SC SD quit; */ #include #include #include #include #include #include #include #include #ifdef LATTICE int CXBRK(void) { return(0); } /* Disable Lattice CTRL/C handling */ int chkabort(void) { return(0); } #endif #define TIMER_CLICKS 100 void main(int, char **); void ProcessMsg(void); void CxFunction(CxMsg *, CxObj *); struct Library *CxBase, *IconBase; struct MsgPort *broker_mp; CxObj *broker, *cocustom, *cosignal; struct NewBroker newbroker = { NB_VERSION, "Divert", /* string to identify this broker */ "Divert", "show divert", NBU_UNIQUE | NBU_NOTIFY, /* Don't want any new commodities starting with this name. */ 0, 0, 0, 0 /* If someone tries it, let me know */ }; struct Task *task; ULONG cxsigflag, signal, cxobjsignal; void main(int argc, char **argv) { UBYTE **ttypes; CxMsg *msg; if (CxBase = OpenLibrary("commodities.library", 37L)) { /* open the icon.library for support library functions, ArgArrayInit() and ArgArrayDone() */ if (IconBase = OpenLibrary("icon.library", 36L)) { if (broker_mp = CreateMsgPort()) { newbroker.nb_Port = broker_mp; cxsigflag = 1L mp_SigBit; /* ArgArrayInit() is a support library function (in the 2.0 version of amiga.lib) */ /* that makes it easy to read arguments from either a CLI or from Workbench's */ /* ToolTypes. Because it uses icon.library, the library has to be open before */ /* before calling this function. ArgArrayDone() cleans up after this function. */ ttypes = ArgArrayInit(argc, argv); /* ArgInt() (in amiga.lib) searches through the array set up by ArgArrayInit() */ /* for a specific ToolType. If it finds one, it returns the numeric value of the */ /* number that followed the ToolType (i.e., CX_PRIORITY=7). If it doesn't find */ /* the ToolType, it returns the default value (the third argument) */ newbroker.nb_Pri = (BYTE)ArgInt(ttypes, "CX_PRIORITY", 0); if (broker = CxBroker(&newbroker, NULL)) { /* CxCustom() takes two arguments, a pointer to the custom function */ /* and an ID. Commodities Exchange will assign that ID to any CxMsg */ /* passed to the custom function. */ if (cocustom = CxCustom(CxFunction, 0L)) { AttachCxObj(broker, cocustom); /* Allocate a signal bit for the signal CxObj */ if ( (signal = (ULONG)AllocSignal(-1L)) != -1) { /* set up the signal mask */ cxobjsignal = 1L ie_Class == IECLASS_TIMER) { time++; if (time >= TIMER_CLICKS) { time = 0L; DivertCxMsg(cxm, co, co); } } else time = 0L; } [Back to Amiga Developer Docs ]