

<!DOCTYPE html>
<html class="client-nojs" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<title>Libraries and Devices - AmigaOS Documentation Wiki</title>
<script>(function(){var className="client-js";var cookie=document.cookie.match(/(?:^|; )docwikimwclientpreferences=([^;]+)/);if(cookie){cookie[1].split('%2C').forEach(function(pref){className=className.replace(new RegExp('(^| )'+pref.replace(/-clientpref-\w+$|[^\w-]+/g,'')+'-clientpref-\\w+( |$)'),'$1'+pref+'$2');});}document.documentElement.className=className;}());RLCONF={"wgBreakFrames":false,"wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgRequestId":"aWb_6h3TbDv_vcRQHuo8eQAAAAo","wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"Libraries_and_Devices","wgTitle":"Libraries and Devices","wgCurRevisionId":12419,"wgRevisionId":12419,"wgArticleId":197,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],
"wgPageViewLanguage":"en","wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgRelevantPageName":"Libraries_and_Devices","wgRelevantArticleId":197,"wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]};RLSTATE={"site.styles":"ready","user.styles":"ready","user":"ready","user.options":"loading","ext.pygments":"ready","skins.vector.styles.legacy":"ready","ext.breadCrumbs":"ready"};RLPAGEMODULES=["ext.pygments.view","site","mediawiki.page.ready","mediawiki.toc","skins.vector.legacy.js"];</script>
<script>(RLQ=window.RLQ||[]).push(function(){mw.loader.impl(function(){return["user.options@12s5i",function($,jQuery,require,module){mw.user.tokens.set({"patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
}];});});</script>
<link rel="stylesheet" href="/w/load.php?lang=en&amp;modules=ext.breadCrumbs%2Cpygments%7Cskins.vector.styles.legacy&amp;only=styles&amp;skin=vector">
<script async="" src="/w/load.php?lang=en&amp;modules=startup&amp;only=scripts&amp;raw=1&amp;skin=vector"></script>
<meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="/w/load.php?lang=en&amp;modules=site.styles&amp;only=styles&amp;skin=vector">
<meta name="generator" content="MediaWiki 1.43.0">
<meta name="robots" content="max-image-preview:standard">
<meta name="format-detection" content="telephone=no">
<meta name="viewport" content="width=1120">
<link rel="icon" href="/w/favicon.ico">
<link rel="search" type="application/opensearchdescription+xml" href="/w/rest.php/v1/search" title="AmigaOS Documentation Wiki (en)">
<link rel="EditURI" type="application/rsd+xml" href="//wiki.amigaos.net/w/api.php?action=rsd">
<link rel="alternate" type="application/atom+xml" title="AmigaOS Documentation Wiki Atom feed" href="/w/index.php?title=Special:RecentChanges&amp;feed=atom">
</head>
<body class="skin-vector-legacy mediawiki ltr sitedir-ltr mw-hide-empty-elt ns-0 ns-subject page-Libraries_and_Devices rootpage-Libraries_and_Devices skin-vector action-view"><div id="mw-page-base" class="noprint"></div>
<div id="mw-head-base" class="noprint"></div>
<div id="content" class="mw-body" role="main">
	<a id="top"></a>
	<div id="siteNotice"><div id="localNotice" data-nosnippet=""><div class="default" lang="en" dir="ltr"><p>Copyright (c) Hyperion Entertainment and contributors.
</p></div></div></div>
	<div class="mw-indicators">
	</div>
	<h1 id="firstHeading" class="firstHeading mw-first-heading"><span class="mw-page-title-main">Libraries and Devices</span></h1>
	<div id="bodyContent" class="vector-body">
		<div id="siteSub" class="noprint">From AmigaOS Documentation Wiki</div>
		<div id="contentSub"><div id="mw-content-subtitle"></div></div>
		<div id="contentSub2"></div>
		
		<div id="jump-to-nav"></div>
		<a class="mw-jump-link" href="#mw-head">Jump to navigation</a>
		<a class="mw-jump-link" href="#searchInput">Jump to search</a>
		<div id="mw-content-text" class="mw-body-content"><div id="breadcrumbs"> <a href="/wiki/Tags" title="Tags">Tags</a> &gt; <a href="/wiki/Callback_Hooks" title="Callback Hooks">Callback Hooks</a> &gt; <a href="/wiki/GUI_Programming" title="GUI Programming">GUI Programming</a> &gt; <a href="/wiki/Programming_in_the_Amiga_Environment" title="Programming in the Amiga Environment">Programming in the Amiga Environment</a> &gt; <a href="/wiki/Libraries_and_Devices" title="Libraries and Devices">Libraries and Devices</a></div><div class="mw-content-ltr mw-parser-output" lang="en" dir="ltr"><div id="toc" class="toc" role="navigation" aria-labelledby="mw-toc-heading"><input type="checkbox" role="button" id="toctogglecheckbox" class="toctogglecheckbox" style="display:none" /><div class="toctitle" lang="en" dir="ltr"><h2 id="mw-toc-heading">Contents</h2><span class="toctogglespan"><label class="toctogglelabel" for="toctogglecheckbox"></label></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Introduction"><span class="tocnumber">1</span> <span class="toctext">Introduction</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Overview"><span class="tocnumber">1.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#The_Self_Pointer_and_the_APICALL_Tag"><span class="tocnumber">1.2</span> <span class="toctext">The Self Pointer and the APICALL Tag</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="#Migrating_a_Library_from_AmigaOS_3.x"><span class="tocnumber">2</span> <span class="toctext">Migrating a Library from AmigaOS 3.x</span></a>
<ul>
<li class="toclevel-2 tocsection-5"><a href="#Introduction_2"><span class="tocnumber">2.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Interface_Definition_Files"><span class="tocnumber">2.2</span> <span class="toctext">Interface Definition Files</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Migrating_the_Source_Code"><span class="tocnumber">2.3</span> <span class="toctext">Migrating the Source Code</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Handling_68K"><span class="tocnumber">3</span> <span class="toctext">Handling 68K</span></a>
<ul>
<li class="toclevel-2 tocsection-9"><a href="#Overview_2"><span class="tocnumber">3.1</span> <span class="toctext">Overview</span></a></li>
<li class="toclevel-2 tocsection-10"><a href="#Native_Interfaces_to_68K_Libraries"><span class="tocnumber">3.2</span> <span class="toctext">Native Interfaces to 68K Libraries</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-11"><a href="#Using_idltool"><span class="tocnumber">4</span> <span class="toctext">Using idltool</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Introduction">Introduction</span></h2>
<h4><span class="mw-headline" id="Overview">Overview</span></h4>
<p>This guide is most specifically directed at programmers wanting to convert library code to AmigaOS 4.x. A (hopefully) comprehensive explanation of the process of converting a library will be presented.
</p><p>For an introduction to some basic concepts see <a href="/wiki/Exec_Libraries" title="Exec Libraries">Exec Libraries</a>.
</p>
<h4><span class="mw-headline" id="The_Self_Pointer_and_the_APICALL_Tag">The Self Pointer and the APICALL Tag</span></h4>
<p>If you look at the standard vector declarations above, you will notice that their first parameter is always a "struct Interface *Self", but we do not specify that Self parameter in the calls. Instead, all method function pointers have a tag APICALL added. That tag identifies them as interface function pointers.
</p><p>Through this special function attribute, the gcc compiler for AmigaOS 4 will recognize a construct of the form
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="n">IExec</span><span class="o">-&gt;</span><span class="n">CloseLibrary</span><span class="p">(</span><span class="n">libBase</span><span class="p">);</span>
</pre></div>
<p>and implicitly (not by preprocessor magic, but through the code generator) transform this into
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="n">IExec</span><span class="o">-&gt;</span><span class="n">CloseLibrary</span><span class="p">(</span><span class="n">IExec</span><span class="p">,</span><span class="w"> </span><span class="n">libBase</span><span class="p">);</span>
</pre></div>
<p>This saves the user the hassle of writing this, but of course this only works on the AmigaOS 4 compiler. Obviously, any compiler adapted for AmigaOS 4 must implement this mechanism.
</p>
<h2><span class="mw-headline" id="Migrating_a_Library_from_AmigaOS_3.x">Migrating a Library from AmigaOS 3.x</span></h2>
<h4><span class="mw-headline" id="Introduction_2">Introduction</span></h4>
<p>Migrating a library from AmigaOS 3.x may or may not be trivial. It all depends on the internals of the library. For a library function itself, the most obvious change is that the library base will not be passed along, but the interface pointer. The interface pointer, however, contains the library base pointer, so if that is required it can still be gotten from the interface. Also, the interface itself may carry along private or instance data.
</p>
<h4><span class="mw-headline" id="Interface_Definition_Files">Interface Definition Files</span></h4>
<p>The first thing to do when starting a new library or migrating an existing one is to write the IDL file . The IDL file is what used to be the FD file in the old system, with a few substantial differences. First of all, the file format is now XML, using a special "library" DTD. The file should have the same base name as the library with the suffix ".xml" added, e.g. exec.xml, expansion.xml and so on. Each IDL file should start like this:
</p>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;iso-8859-1&quot;?&gt;</span>
<span class="cp">&lt;!DOCTYPE library SYSTEM &quot;library.dtd&quot;&gt;</span>
<span class="nt">&lt;library</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;expansion&quot;</span><span class="w"> </span><span class="na">basename=</span><span class="s">&quot;ExpansionBase&quot;</span><span class="nt">&gt;</span>
...
<span class="nt">&lt;/library&gt;</span>
</pre></div>
<p>This declares an XML file and includes the dtd. The third line (&lt;library...&gt;) defines the document's contents, in this case a single library. The "name" attribute specifies the name of the library. A ".library" is implicitly added to this name. The second attribute (basename) specifies the global name of the library base and the name of the base structure (i.e. struct ExpansionBase * in this case). Note that the library base pointer need not be global at all for a function to be called - only the interface pointer is used for that.
</p><p>The &lt;library&gt; element may contain any number of &lt;include&gt; elements. &lt;include&gt; elements specify include files that need to be present to define all types that are used within the library. The files &lt;exec/interfaces.h&gt; and &lt;exec/types.h&gt; are implicitly added. The name of the include file must be given as contents to the &lt;include&gt; element, and only one such file is allowed per element:
</p>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="nt">&lt;include&gt;</span>expansion/pci.h<span class="nt">&lt;/include&gt;</span>
</pre></div>
<p>After the &lt;include&gt; element, you should start listing all library interfaces. There can be any number of interfaces. Interfaces are specified using the &lt;interface&gt; element:
</p>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="nt">&lt;interface</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;pci&quot;</span><span class="w"> </span><span class="na">version=</span><span class="s">&quot;1&quot;</span><span class="w"> </span><span class="na">flags=</span><span class="s">&quot;protected&quot;</span><span class="w"> </span><span class="na">struct=</span><span class="s">&quot;PCIIFace&quot;</span><span class="w"> </span><span class="na">prefix=</span><span class="s">&quot;_pci_&quot;</span><span class="nt">&gt;</span>
</pre></div>
<p>The following attributes exist:
</p>
<ul><li>name (required) The name of the interface. This name will be used by an application to request the interface.</li></ul>
<ul><li>version (default: 1) The version of the interface. Interface versions start at 1. Multiple interfaces with the same name may be defined if and only if they have different version numbers. Once an interface is published, it must not be changed unless the interface version number is incremented.</li></ul>
<ul><li>flags (default: none) The flags to set for this interface. This may be "protected", "private", or "none", with obvious mappings to the interface flags.</li></ul>
<ul><li>struct (required) The name of the structure that holds the interface, automatically prefixed by "struct". The example above specifies the struct name to be "PCIIFace", that means that any interface acquired from expansion library by the name of "pci" will have the layout of "struct PCIIFace".</li></ul>
<ul><li>prefix (default: "_impl_") The common prefix for all interface functions. It is highly recommended that all interface functions get a command prefix, since some function names might be ambiguous, like Obtain, Release, Expunge and Clone. This prefix is used for the automatic library creation process.</li></ul>
<p>The &lt;interface&gt; element may contain any number of &lt;method&gt; elements. &lt;method&gt; elements describe the methods that an interface provides. Contrary to FD files the method description also contains the return types and parameter types. The following lists the four standard interface methods, which must be first in every interface:
</p>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="nt">&lt;method</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Obtain&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;uint32&quot;</span><span class="nt">&gt;&lt;/method&gt;</span>
<span class="nt">&lt;method</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Release&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;uint32&quot;</span><span class="nt">&gt;&lt;/method&gt;</span>
<span class="nt">&lt;method</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Expunge&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;void&quot;</span><span class="w"> </span><span class="na">status=</span><span class="s">&quot;unimplemented&quot;</span><span class="nt">&gt;&lt;/method&gt;</span>
<span class="nt">&lt;method</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Clone&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;struct Interface *&quot;</span><span class="w"> </span><span class="na">status=</span><span class="s">&quot;unimplemented&quot;</span><span class="nt">&gt;&lt;/method&gt;</span>
</pre></div>
<p>These methods don't have any other parameter but the Self pointer, which is implicit and need not be named. The "name" attribute defines the name of that method, the name under which the method is called when used. Together with the prefix specified in the interface, it forms the name of the function (see the testlib example). The "result" attribute describes what the method returns, which may be "void" if the function does not return anything, or a type like "uint32", or even a complex type like "struct Interface *". Finally, the "status" attribute used by some methods (which defaults to "implemented") specifies if the method actually exists or not. If it doesn't exist, set this to "unimplemented". This will "reserve" a slot in the interface's jump table, but fill it with NULL. Obviously, calling such a function results in Violent Program Termination.
</p><p>After these initial methods, you need to add a &lt;method&gt; element for each method in the interface. Methods without parameters can be written as above, or in a single tag, as per XML specifications:
</p>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="nt">&lt;method</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Obtain&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;uint32&quot;</span><span class="nt">/&gt;</span>
</pre></div>
<p>If a method has arguments (the most common case), the arguments must be listed as &lt;arg&gt; elements:
</p>
<div class="mw-highlight mw-highlight-lang-xml mw-content-ltr" dir="ltr"><pre><span></span><span class="nt">&lt;method</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;AllocResource&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;struct PCIResourceRange *&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ResType&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;uint32&quot;</span><span class="nt">/&gt;</span>
<span class="w"> </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;NumBytes&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;uint32&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/method&gt;</span>

<span class="nt">&lt;method</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;FreeResource&quot;</span><span class="w"> </span><span class="na">result=</span><span class="s">&quot;void&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;Resource&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;struct PCIResourceRange *&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/method&gt;</span>
</pre></div>
<p>These two declarations would result in the following two method prototypes:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="k">struct</span><span class="w"> </span><span class="nc">PCIResourceRange</span><span class="w"> </span><span class="o">*</span><span class="n">AllocResource</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">PCIIFace</span><span class="w"> </span><span class="o">*</span><span class="n">Self</span><span class="p">,</span>
<span class="linenos" data-line="2"></span><span class="w"> </span><span class="n">uint32</span><span class="w"> </span><span class="n">ResType</span><span class="p">,</span><span class="w"> </span><span class="n">uint32</span><span class="w"> </span><span class="n">NumBytes</span><span class="p">);</span>
<span class="linenos" data-line="3"></span><span class="kt">void</span><span class="w"> </span><span class="nf">FreeResource</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">PCIIFace</span><span class="w"> </span><span class="o">*</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">PCIResource</span><span class="w"> </span><span class="o">*</span><span class="n">Resource</span><span class="p">);</span>
</pre></div>
<p>&lt;arg&gt; elements must not have any content, and hence should always be written in the one-tag way.
</p><p>Remember to close the &lt;interface&gt; element by a trailing &lt;/interface&gt;. As was said before, any number of &lt;interface&gt; elements may follow.
</p><p>Once you have written the interface description, the "idltool" program must be used to generate the required header files. Running idltool with the "--all" option generates all available targets.
</p>
<h4><span class="mw-headline" id="Migrating_the_Source_Code">Migrating the Source Code</span></h4>
<p>As has been said before, library calls in AmigaOS 4 are arranged into interfaces. There are four interface methods that every interface has. Usually you can use generic versions of these. The idltool will output a complete skeleton for you which makes it much easier to get going.
</p><p>All functions need to be modified in such a way that the LibBase parameter (if present) is removed, and the new Self parameter needs to be added. For example, consider this function (AmigaOS 3.9 style) from a fictitious library "fubar.library":
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="n">ULONG</span><span class="w"> </span><span class="nf">FubarFunc</span><span class="p">(</span><span class="n">ULONG</span><span class="w"> </span><span class="n">param1</span><span class="p">,</span><span class="w"> </span><span class="n">ULONG</span><span class="w"> </span><span class="n">param2</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="nc">FubarBase</span><span class="w"> </span><span class="o">*</span><span class="n">libBase</span><span class="p">)</span>
<span class="linenos" data-line="2"></span><span class="p">{</span>
<span class="linenos" data-line="3"></span><span class="w"> </span><span class="n">libBase</span><span class="o">-&gt;</span><span class="n">FubarCalled</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-line="4"></span><span class="w"> </span><span class="n">ULONG</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">libBase</span><span class="o">-&gt;</span><span class="n">FubarFactor</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">param2</span><span class="p">;</span>
<span class="linenos" data-line="5"></span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="linenos" data-line="6"></span><span class="p">}</span>
</pre></div>
<p>The modifications required mostly depend on a few design choices we have to make. The "FubarCalled" variable is part of the library base in the example above but that need not be the case for AmigaOS 4 - we can move this field either to the interface private data or leave it in the library base.
</p><p>We assume that our interface for the library is called "FubarMainIFace". You may chose any name but it is recommended (though not enforced) that they start with the library name and end with "IFace".
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="n">uint32</span><span class="w"> </span><span class="nf">FubarFunc</span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">FubarMainIFace</span><span class="w"> </span><span class="o">*</span><span class="n">Self</span><span class="p">,</span><span class="w"> </span><span class="n">uint32</span><span class="w"> </span><span class="n">param1</span><span class="p">,</span><span class="w"> </span><span class="n">uint32</span><span class="w"> </span><span class="n">param2</span><span class="p">)</span>
<span class="linenos" data-line="2"></span><span class="p">{</span>
</pre></div>
<p>So far, things that have changed is the types are modernized and the removal of the libBase parameter and the addition of the interface pointer. What follows depends on the choice of placement of the FubarCalled and FoobarFactor fields. Let's first assume that we left them in the library base, so we need a pointer to the library. That pointer is always stored in the interface:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="k">struct</span><span class="w"> </span><span class="nc">FubarBase</span><span class="w"> </span><span class="o">*</span><span class="n">libBase</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">FubarBase</span><span class="w"> </span><span class="o">*</span><span class="p">)</span><span class="n">Self</span><span class="o">-&gt;</span><span class="n">Data</span><span class="p">.</span><span class="n">LibBase</span><span class="p">;</span>
<span class="linenos" data-line="2"></span><span class="w"> </span><span class="n">libBase</span><span class="o">-&gt;</span><span class="n">FubarCalled</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-line="3"></span><span class="w"> </span><span class="n">uint32</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">libBase</span><span class="o">-&gt;</span><span class="n">FubarFactor</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">param2</span><span class="p">;</span>
<span class="linenos" data-line="4"></span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="linenos" data-line="5"></span><span class="p">}</span>
</pre></div>
<p>Now, if we decided to move these fields into the interface itself, things look a bit different. Generally if you think that data is specific to an interface, and hence specific to a task context, put the fields into the interface. Otherwise leave them in the base. Migrated libraries will probably want to keep them in the base structure, but just in case this is the way to access the data from the interface:
</p>
<div class="mw-highlight mw-highlight-lang-c mw-content-ltr mw-highlight-lines" dir="ltr"><pre><span></span><span class="linenos" data-line="1"></span><span class="k">struct</span><span class="w"> </span><span class="nc">FubarMainData</span><span class="w"> </span><span class="o">*</span><span class="n">ifData</span><span class="w"> </span><span class="o">=</span>
<span class="linenos" data-line="2"></span><span class="w"> </span><span class="p">(</span><span class="k">struct</span><span class="w"> </span><span class="nc">FubarMainData</span><span class="w"> </span><span class="o">*</span><span class="p">)((</span><span class="n">uint32</span><span class="p">)</span><span class="n">Self</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Self</span><span class="o">-&gt;</span><span class="n">Data</span><span class="p">.</span><span class="n">NegativeSize</span><span class="p">);</span>
<span class="linenos" data-line="3"></span><span class="w"> </span><span class="n">ifData</span><span class="o">-&gt;</span><span class="n">FubarCalled</span><span class="o">++</span><span class="p">;</span>
<span class="linenos" data-line="4"></span><span class="w"> </span><span class="n">uint32</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">param1</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">ifData</span><span class="o">-&gt;</span><span class="n">FubarFactor</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">param2</span><span class="p">;</span>
<span class="linenos" data-line="5"></span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
<span class="linenos" data-line="6"></span><span class="p">}</span>
</pre></div>
<p>This example assumes that your data layout for the interface looks like the struct FubarMainData structure.
</p>
<h2><span class="mw-headline" id="Handling_68K">Handling 68K</span></h2>
<h4><span class="mw-headline" id="Overview_2">Overview</span></h4>
<p>There are two possible scenarios from where a library might be called: From native code, or from 68k code. The native code calls will invariably go via an interface; the 68k calls will always be base-relative.
</p><p>This means that for a library to be native-callable, at least one interface must exist. Since this is only some sort of switchboard, we will call these "proxy" interfaces: the interface just redirects calls through the emulator.
</p><p>This also means that if a native library needs to be callable from 68k, it must have a jump table. Of course, for a 68k program to call a native library, this program must know the library; it is highly unlikely that a 68k program will call the PCI interface of expansion.library directly (i.e. not through an emulation layer) because it will most likely not know that expansion.library offers anything but the "normal" functions.
</p>
<h4><span class="mw-headline" id="Native_Interfaces_to_68K_Libraries">Native Interfaces to 68K Libraries</span></h4>
<p>A 68k library that needs to be native-callable needs an interface. That interface may be created through two different mechanisms. For a disk-based library, the loader will scan the directory for a file that contains this interface, to be loaded with the library. This file may or may not contain additional code that replaces some of the library vectors.
</p><p>For resident libraries, this looks a bit different. Resident libraries must have the interface already created in memory. Since these libraries are most likely part of the system itself, these libraries should be treated very much like a native library.
</p><p>Assume for example that graphics.library would remain 68k. In order to call it from native code, it needs to have an interface (preferably "main"). This is achieved by inserting a ROMTAG with a priority of one lower than the actual library, which constructs the interface and stores it as an interface of Exec, under the name "graphics.interface". When a program attempts to obtain an interface from a non-AmigaOS 4 library, Exec's GetInterface function constructs this name from the library name and returns the pointer to this "proxy" interface.
</p>
<h2><span class="mw-headline" id="Using_idltool">Using idltool</span></h2>
<p>The utility program idltool can be used to generate libraries as well, in a very convenient manner. All you have to do is provide the XML interface description file and invoke idltool with the command line
</p>
<pre>idltool -k &lt;interfacefile&gt;.xml
</pre>
<p>This will create a directory &lt;interfacefile&gt;_files in your current directory that contains a complete skeleton library with a Makefile and a README with additional instructions. Simply typing "make" should build the library. For more information, refer to the documentation that comes with idltool.
</p>
<!-- 
NewPP limit report
Cached time: 20260114023108
Cache expiry: 86400
Reduced expiry: false
Complications: [show‐toc]
CPU time usage: 0.082 seconds
Real time usage: 2.078 seconds
Preprocessor visited node count: 101/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/100
Expensive parser function count: 13/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 13785/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->

<!-- Saved in parser cache with key docwiki:pcache:idhash:197-0!canonical and timestamp 20260114023108 and revision id 12419. Rendering was triggered because: page-view
 -->
</div>
<div class="printfooter" data-nosnippet="">Retrieved from "<a dir="ltr" href="http://wiki.amigaos.net/w/index.php?title=Libraries_and_Devices&amp;oldid=12419">http://wiki.amigaos.net/w/index.php?title=Libraries_and_Devices&amp;oldid=12419</a>"</div></div>
		<div id="catlinks" class="catlinks catlinks-allhidden" data-mw="interface"></div>
	</div>
</div>

<div id="mw-navigation">
	<h2>Navigation menu</h2>
	<div id="mw-head">
		
<nav id="p-personal" class="mw-portlet mw-portlet-personal vector-user-menu-legacy vector-menu" aria-labelledby="p-personal-label"  >
	<h3
		id="p-personal-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Personal tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="pt-login" class="mw-list-item"><a href="/w/index.php?title=Special:UserLogin&amp;returnto=Libraries+and+Devices" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o"><span>Log in</span></a></li>
		</ul>
		
	</div>
</nav>

		<div id="left-navigation">
			
<nav id="p-namespaces" class="mw-portlet mw-portlet-namespaces vector-menu-tabs vector-menu-tabs-legacy vector-menu" aria-labelledby="p-namespaces-label"  >
	<h3
		id="p-namespaces-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Namespaces</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-nstab-main" class="selected mw-list-item"><a href="/wiki/Libraries_and_Devices" title="View the content page [c]" accesskey="c"><span>Page</span></a></li><li id="ca-talk" class="new mw-list-item"><a href="/w/index.php?title=Talk:Libraries_and_Devices&amp;action=edit&amp;redlink=1" rel="discussion" class="new" title="Discussion about the content page (page does not exist) [t]" accesskey="t"><span>Discussion</span></a></li>
		</ul>
		
	</div>
</nav>

			
<nav id="p-variants" class="mw-portlet mw-portlet-variants emptyPortlet vector-menu-dropdown vector-menu" aria-labelledby="p-variants-label"  >
	<input type="checkbox"
		id="p-variants-checkbox"
		role="button"
		aria-haspopup="true"
		data-event-name="ui.dropdown-p-variants"
		class="vector-menu-checkbox"
		aria-labelledby="p-variants-label"
	>
	<label
		id="p-variants-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">English</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</nav>

		</div>
		<div id="right-navigation">
			
<nav id="p-views" class="mw-portlet mw-portlet-views vector-menu-tabs vector-menu-tabs-legacy vector-menu" aria-labelledby="p-views-label"  >
	<h3
		id="p-views-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Views</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="ca-view" class="selected mw-list-item"><a href="/wiki/Libraries_and_Devices"><span>Read</span></a></li><li id="ca-viewsource" class="mw-list-item"><a href="/w/index.php?title=Libraries_and_Devices&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e"><span>View source</span></a></li><li id="ca-history" class="mw-list-item"><a href="/w/index.php?title=Libraries_and_Devices&amp;action=history" title="Past revisions of this page [h]" accesskey="h"><span>View history</span></a></li>
		</ul>
		
	</div>
</nav>

			
<nav id="p-cactions" class="mw-portlet mw-portlet-cactions emptyPortlet vector-menu-dropdown vector-menu" aria-labelledby="p-cactions-label"  title="More options" >
	<input type="checkbox"
		id="p-cactions-checkbox"
		role="button"
		aria-haspopup="true"
		data-event-name="ui.dropdown-p-cactions"
		class="vector-menu-checkbox"
		aria-labelledby="p-cactions-label"
	>
	<label
		id="p-cactions-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">More</span>
	</label>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			
		</ul>
		
	</div>
</nav>

			
<div id="p-search" role="search" class="vector-search-box-vue  vector-search-box-show-thumbnail vector-search-box-auto-expand-width vector-search-box">
	<h3 >Search</h3>
	<form action="/w/index.php" id="searchform" class="vector-search-box-form">
		<div id="simpleSearch"
			class="vector-search-box-inner"
			 data-search-loc="header-navigation">
			<input class="vector-search-box-input"
				 type="search" name="search" placeholder="Search AmigaOS Documentation Wiki" aria-label="Search AmigaOS Documentation Wiki" autocapitalize="sentences" title="Search AmigaOS Documentation Wiki [f]" accesskey="f" id="searchInput"
			>
			<input type="hidden" name="title" value="Special:Search">
			<input id="mw-searchButton"
				 class="searchButton mw-fallbackSearchButton" type="submit" name="fulltext" title="Search the pages for this text" value="Search">
			<input id="searchButton"
				 class="searchButton" type="submit" name="go" title="Go to a page with this exact name if it exists" value="Go">
		</div>
	</form>
</div>

		</div>
	</div>
	
<div id="mw-panel" class="vector-legacy-sidebar">
	<div id="p-logo" role="banner">
		<a class="mw-wiki-logo" href="/wiki/Main_Page"
			title="Visit the main page"></a>
	</div>
	
<nav id="p-Navigation" class="mw-portlet mw-portlet-Navigation vector-menu-portal portal vector-menu" aria-labelledby="p-Navigation-label"  >
	<h3
		id="p-Navigation-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Navigation</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-mainpage-description" class="mw-list-item"><a href="/wiki/Main_Page" title="Visit the main page [z]" accesskey="z"><span>Main page</span></a></li><li id="n-recentchanges" class="mw-list-item"><a href="/wiki/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r"><span>Recent changes</span></a></li>
		</ul>
		
	</div>
</nav>

	
<nav id="p-Developers" class="mw-portlet mw-portlet-Developers vector-menu-portal portal vector-menu" aria-labelledby="p-Developers-label"  >
	<h3
		id="p-Developers-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Developers</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-Autodocs" class="mw-list-item"><a href="/wiki/Autodocs:Main"><span>Autodocs</span></a></li><li id="n-Tutorials" class="mw-list-item"><a href="/wiki/Tutorials:Main"><span>Tutorials</span></a></li><li id="n-Registries" class="mw-list-item"><a href="/wiki/DeveloperDoc:Registries"><span>Registries</span></a></li><li id="n-Standards" class="mw-list-item"><a href="/wiki/DeveloperDoc:Standards"><span>Standards</span></a></li><li id="n-Reference" class="mw-list-item"><a href="/wiki/DeveloperDoc:Main"><span>Reference</span></a></li><li id="n-AmigaOS-Support-Forums" class="mw-list-item"><a href="https://www.amigaos.net/viewforum.php?f=25" rel="nofollow"><span>AmigaOS Support Forums</span></a></li><li id="n-OS4Coding-Forum" class="mw-list-item"><a href="https://os4coding.net/forum" rel="nofollow"><span>OS4Coding Forum</span></a></li><li id="n-Get-the-SDK" class="mw-list-item"><a href="https://www.hyperion-entertainment.com/index.php/downloads?view=files&amp;parent=30" rel="nofollow"><span>Get the SDK</span></a></li>
		</ul>
		
	</div>
</nav>

<nav id="p-Users" class="mw-portlet mw-portlet-Users vector-menu-portal portal vector-menu" aria-labelledby="p-Users-label"  >
	<h3
		id="p-Users-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Users</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-Workbench" class="mw-list-item"><a href="/wiki/AmigaOS_Manual:_Workbench"><span>Workbench</span></a></li><li id="n-DOS" class="mw-list-item"><a href="/wiki/AmigaOS_Manual:_AmigaDOS"><span>DOS</span></a></li><li id="n-ARexx" class="mw-list-item"><a href="/wiki/AmigaOS_Manual:_ARexx"><span>ARexx</span></a></li><li id="n-Bars-&amp;-Pipes-Professional" class="mw-list-item"><a href=""><span>Bars &amp; Pipes Professional</span></a></li>
		</ul>
		
	</div>
</nav>

<nav id="p-Links" class="mw-portlet mw-portlet-Links vector-menu-portal portal vector-menu" aria-labelledby="p-Links-label"  >
	<h3
		id="p-Links-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Links</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="n-Hyperion-Entertainment" class="mw-list-item"><a href="https://www.hyperion-entertainment.com/" rel="nofollow"><span>Hyperion Entertainment</span></a></li><li id="n-AmigaOS-Web-Site" class="mw-list-item"><a href="https://www.amigaos.net/" rel="nofollow"><span>AmigaOS Web Site</span></a></li><li id="n-AmigaOS-Support-Forums" class="mw-list-item"><a href="http://support.amigaos.net/" rel="nofollow"><span>AmigaOS Support Forums</span></a></li>
		</ul>
		
	</div>
</nav>

<nav id="p-tb" class="mw-portlet mw-portlet-tb vector-menu-portal portal vector-menu" aria-labelledby="p-tb-label"  >
	<h3
		id="p-tb-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Tools</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="t-whatlinkshere" class="mw-list-item"><a href="/wiki/Special:WhatLinksHere/Libraries_and_Devices" title="A list of all wiki pages that link here [j]" accesskey="j"><span>What links here</span></a></li><li id="t-recentchangeslinked" class="mw-list-item"><a href="/wiki/Special:RecentChangesLinked/Libraries_and_Devices" rel="nofollow" title="Recent changes in pages linked from this page [k]" accesskey="k"><span>Related changes</span></a></li><li id="t-specialpages" class="mw-list-item"><a href="/wiki/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q"><span>Special pages</span></a></li><li id="t-print" class="mw-list-item"><a href="javascript:print();" rel="alternate" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li><li id="t-permalink" class="mw-list-item"><a href="/w/index.php?title=Libraries_and_Devices&amp;oldid=12419" title="Permanent link to this revision of this page"><span>Permanent link</span></a></li><li id="t-info" class="mw-list-item"><a href="/w/index.php?title=Libraries_and_Devices&amp;action=info" title="More information about this page"><span>Page information</span></a></li>
		</ul>
		
	</div>
</nav>

<nav id="p-coll-print_export" class="mw-portlet mw-portlet-coll-print_export vector-menu-portal portal vector-menu" aria-labelledby="p-coll-print_export-label"  >
	<h3
		id="p-coll-print_export-label"
		
		class="vector-menu-heading "
	>
		<span class="vector-menu-heading-label">Print/export</span>
	</h3>
	<div class="vector-menu-content">
		
		<ul class="vector-menu-content-list">
			
			<li id="coll-create_a_book" class="mw-list-item"><a href="/w/index.php?title=Special:Book&amp;bookcmd=book_creator&amp;referer=Libraries+and+Devices"><span>Create a book</span></a></li><li id="coll-download-as-rl" class="mw-list-item"><a href="/w/index.php?title=Special:Book&amp;bookcmd=render_article&amp;arttitle=Libraries+and+Devices&amp;oldid=12419&amp;writer=rl"><span>Download as PDF</span></a></li><li id="t-print" class="mw-list-item"><a href="/w/index.php?title=Libraries_and_Devices&amp;printable=yes" title="Printable version of this page [p]" accesskey="p"><span>Printable version</span></a></li>
		</ul>
		
	</div>
</nav>

	
</div>

</div>

<footer id="footer" class="mw-footer" >
	<ul id="footer-info">
	<li id="footer-info-lastmod"> This page was last edited on 26 January 2025, at 19:06.</li>
</ul>

	<ul id="footer-places">
	<li id="footer-places-privacy"><a href="/wiki/AmigaOS_Documentation_Wiki:Privacy_policy">Privacy policy</a></li>
	<li id="footer-places-about"><a href="/wiki/AmigaOS_Documentation_Wiki:About">About AmigaOS Documentation Wiki</a></li>
	<li id="footer-places-disclaimers"><a href="/wiki/AmigaOS_Documentation_Wiki:General_disclaimer">Disclaimers</a></li>
</ul>

	<ul id="footer-icons" class="noprint">
	<li id="footer-poweredbyico"><a href="https://www.mediawiki.org/" class="cdx-button cdx-button--fake-button cdx-button--size-large cdx-button--fake-button--enabled"><img src="/w/resources/assets/poweredby_mediawiki.svg" alt="Powered by MediaWiki" width="88" height="31" loading="lazy"></a></li>
</ul>

</footer>

<script>(RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":2175,"wgPageParseReport":{"limitreport":{"cputime":"0.082","walltime":"2.078","ppvisitednodes":{"value":101,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":100},"expensivefunctioncount":{"value":13,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":13785,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20260114023108","ttl":86400,"transientcontent":false}}});});</script>
</body>
</html>