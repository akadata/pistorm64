#!/usr/bin/env bash
set -e
#FREQS=(20000000 50000000 100000000 150000000 200000000)
FREQS=(20000000 50000000 100000000 150000000 200000000 400000000)
export PISTORM_PROTOCOL=old
export PISTORM_OLD_NO_HANDSHAKE=1
export PISTORM_RP1_CLK_FUNCSEL=0
export PISTORM_ENABLE_GPCLK=0
export PISTORM_TXN_TIMEOUT_US=200000

for f in "${FREQS[@]}"; do
echo "=== freq=$f ==="
./setcheckclock "$f" --no-emulator-probe --force-high || true
sudo env PISTORM_PROTOCOL=$PISTORM_PROTOCOL \
PISTORM_OLD_NO_HANDSHAKE=$PISTORM_OLD_NO_HANDSHAKE \
PISTORM_RP1_CLK_FUNCSEL=$PISTORM_RP1_CLK_FUNCSEL \
PISTORM_ENABLE_GPCLK=$PISTORM_ENABLE_GPCLK \
PISTORM_TXN_TIMEOUT_US=$PISTORM_TXN_TIMEOUT_US \
./emulator --bus-probe | head -n 8
echo
sleep 1
done
